[Erweiterung](extension.md) | [Inhalt](README.md#test)
- - -

# Test

Das Test-API unterstützt die Implementierung und Ausführung von
Integrationstests und kann für Suiten (suite), Szenarien (scenario) und einzelne
Testfälle (case) verwendet werden.

Als modularer Bestandteil von Seanox aspect-js ist das Test-API in jedem Release
enthalten ist, der sich ohne Probleme entfernen lässt. Da das Test-API einige
Besonderheiten in Bezug auf Fehlerbehandlung und Konsolen-Ausgabe bewirkt, muss
das Test-API zur Laufzeit bewusst aktiviert werden.

```javascript
Test.activate();

Test.create({test:function() {
    ...
}});

Test.start();
```


## Inhalt

* [Testfall](#testfall)
  * [name](#name)
  * [test](#test)
  * [timeout](#timeout)
  * [expected](#expected)
  * [ignore](#ignore)
* [Szenario](#szenario)
* [Suite](#suite)
* [Assert](#assert)
  * [assertTrue](#asserttrue)
  * [assertFalse](#assertfalse)
  * [assertEquals](#assertequals)
  * [assertNotEquals](#assertnotequals)
  * [assertSame](#assertsame)
  * [assertNotSame](#assertnotsame)
  * [assertNull](#assertnull)
  * [assertNotNull](#assertnotnull)
  * [fail](#fail)
* [Konfiguration](#konfiguration)
  * [Output](#output)
  * [Monitor](#monitor)
* [Output](#output-1)
  * [Forwarding](#forwarding)
  * [Buffer](#buffer)
  * [Listener](#listener)
* [Monitoring](#monitoring)
* [Control](#control)
* [Events](#events)


### Testfall

Der kleinste Bestandteil in einem Integrationstest, der hier als "Task"
verwendet wird, da "Case" ein Schlüsselwort im JavaScript ist. Es kann allein
implementiert werden, wird aber immer in einem Szenario verwendet.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertTrue(true);
}});

Test.start();
```

Task ist primär ein Meta-Objekt.  

```
{name:..., test:..., timeout:..., expected:..., ignore:...}
```


#### name

Optionaler Name vom Testfall.


#### test

Die implementierte Methode, die als Testfall ausgeführt werden soll.


#### timeout

Optional Angabe der maximalen Laufzeit des Testfalls in Millisekunden.
Das Überschreiten von diesem Wetr führt zum Ausfall des Tests.  
Es wird ein Wert größer als 0 erwartet, ansonsten wird der Timeout ignoriert.


#### expected

Optional, um das Auftreten von definierten Fehlern zu testen.
Der Fehler muss auftreten, damit der Test erfolgreich ist.
Als Wert wird ein Fehlerobjekt oder eine RegExp erwartet.

#### ignore

Optional true, wenn der Test ignoriert werden so


### Szenario

Ein Szenario ist eine Abfolge von vielen Testfällen (Tasks).

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertTrue(true);
}});
Test.create({name:"example", timeout:1000, test:function() {
    Assert.assertTrue(true);
}});
Test.create({error:Error test:function() {
    throw new Error();
}});
Test.create({error:/^My Error/i, test:function() {
    throw new Error("My Error");
}});
Test.create({ignore:true, test:function() {
    Assert.assertTrue(true);
}});

Test.start();
```


### Suite 

Eine Suite ist ein komplexes Paket aus verschiedenen Testfällen, Szenarien und
anderen Suiten. In der Regel besteht eine Suite aus verschiedenen Dateien, die
dann einen komplexen Test darstellen. Ein Beispiel für eine gute Suite ist eine
Kaskade von verschiedenen Dateien und wo der Test in jeder Datei und an jedem
Stelle gestartet werden kann. Dies ermöglicht einen Integrationstest auf
verschiedenen Ebenen und mit unterschiedlicher Komplexität.

 
### Assert

Die Testfälle werden mit Behauptungen (Assertions) implementiert. Das Test-API
bietet elementare Aussagen, die erweitert werden können. Die Funktion ist
einfach. Wenn eine Behauptung nicht wahr ist, tritt ein Fehler auf.


### assertTrue

Behauptet, dass ein Wert `true` ist.  
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertTrue(true);
}});
Test.create({test:function() {
    Assert.assertTrue("message", true);
}});

Test.start();
```


### assertFalse

Behauptet, dass ein Wert `false` ist, als Negation von `Assert.assertTrue(....)`.  
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertFalse(false);
}});
Test.create({test:function() {
    Assert.assertFalse("message", false);
}});

Test.start();
```


### assertEquals
    
Behauptet, dass zwei Werte identisch sind.  
Unterschied zwischen identisch und gleich: `=== / ==` oder `!== / !=`  
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertEquals(expected, value);
}});
Test.create({test:function() {
    Assert.assertEquals("message", expected, value);
}});

Test.start();
```


### assertNotEquals
    
Behauptet, dass zwei Werte nicht identisch sind, als Negation von `Assert.assertEquals(....)`.  
Unterschied zwischen identisch und gleich: `=== / ==` oder `!== / !=`    
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertNotEquals(unexpected, value);
}});
Test.create({test:function() {
    Assert.assertNotEquals("message", unexpected, value);
}});

Test.start();
```


### assertSame

Behauptet, dass zwei Werte gleich sind.   
Unterschied zwischen identisch und gleich: `=== / ==` oder `!== / !=`   
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertSame(expected, value);
}});
Test.create({test:function() {
    Assert.assertSame("message", expected, value);
}});

Test.start();
```


### assertNotSame        
    
Behauptet, dass zwei Werte nicht gleich sind, als Negation von `Assert.assertSame(....)`.
Unterschied zwischen identisch und gleich: `=== / ==` oder `!== / !=`  
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertNotSame(unexpected, value);
}});
Test.create({test:function() {
    Assert.assertNotSame("message", unexpected, value);
}});

Test.start();
```


### assertNull

Behauptet, dass ein Wert `null` ist.  
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertNull(null);
}});
Test.create({test:function() {
    Assert.assertNull("message", null);
}});

Test.start();
```


### assertNotNull

Behauptet, dass ein Wert nicht `null` ist, als Negation von `Assert.assertNull(....)`.  
Ist die Behauptung unwahr, führt dies zu einem Fehler mit optionaler Meldung.   
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.assertNotNull(null);
}});
Test.create({test:function() {
    Assert.assertNotNull("message", null);
}});

Test.start();
```


### fail

Verusacht das Scheitern einen Test mit mit optionalen Meldung.
Die Methode hat unterschiedliche Signaturen.

```javascript
Test.activate();

Test.create({test:function() {
    Assert.fail();
}});
Test.create({test:function() {
    Assert.fail("message");
}});

Test.start();
```


## Konfiguration

Optional kann das Test-API, mit Fokus auf Überwachung konfiguriert werden.  
Die Konfiguration kann einmalig und mehrfach aufgerufen werden. Als Parameter
wird ein Meta-Objekt erwartet. Die darin enthaltene Konfiguration wird partiell
übernommen und unbekanntes wird ignoriert.


```javascript
Test.configure({
    log:function(message) {
        ...
    },
    error:function(message) {
        ...
    },
    ...
});

Test.configure({
    start:function(status) {
        ...
    },
    perform:function(status) {
        ...
    },
    response:function(status) {
        ...
    },
    
    finish:function(status) {
        ...
    }
});

```


### Output

Funktion oder Objekt zur Ausgabe von Meldungen und Fehlern.  
Wenn nicht angegeben, wird das console-Objekt verwendet.

```javascript
Test.configure({
    log:function(message) {
        ...
    },
    error:function(message) {
        ...
    }
});
```


### Monitor

Überwacht den Testablauf und wird während der Ausführung über die verschiedenen
Schritte und Status informiert. Der Monitor kann auch für die Datenausgabe
verwendet werden und z.B. die Ausgabe in ein DOM-Element umleiten.  
Der Monitor ist optional. Ohne diesen werden Informationen zum Testverlauf in
der Konsole ausgegeben.

```javascript
Test.configure({

    start:function(status) {
        Aufruf der Methode beim Start.
    },
    
    suspend:function(status) {
        Aufruf der Methode bei einer Unterbrechung.
    },
    
    resume:function(status) {
        Aufruf der Methode beim Fortgesetzt des Testverlaufs, wenn
        dieser zuvor unterbrochen wurde.
    },
    
    interrupt:function(status) {
        Aufruf der Methode beim Abbruch vom Testlauf.
        Der Testlauf kann nicht fortgesetzt werden.
    },
    
    perform:function(status) {
        Aufruf der Methode bevor eine Testaufgabe ausgeführt wird.
    },
    
    response:function(status) {
        Aufruf der Methode nach der Ausführung einer Testaufgabe.
        Hier ist das Ergebnis der Testaufgabe enthalten.
    },
    
    finish:function(status) {
        Aufruf der Methode, wenn alle Testaufgaben abgeschlossen sind.
    }
});
```

Allen Monitor-Methoden wird der aktuelle Status als Meta-Objekt übergeben.  
Der Status enthält Details zum aktuellen Test und zur Warteschlange. Die Details
sind schreibgeschützt und können nicht geändert werden.

```javascript
{
    task: {
        title:
            Titel der Testaufgabe,
        meta:
            Meta-Informationen zum Test (name, test, timeout, expected,
            serial),
        running:
            Kennzeichen, wenn die Testaufgabe ausgeführt wird.
        timing:
            Zeitpunkt vom Beginn der Testaufgabe in Millisekunden.
        timeout:
            Optionale Zeit in Millisekunden, zu der ein Timeout
            erwartet wird.
        duration:
            Gesamtausführungszeit der Testaufgabe in Millisekunden nach
            dem Ende der Testaufgabe.
        error:
            Optional, wenn ein unerwarteter Fehler (auch Asser-Fehler)
            aufgetreten ist, der die Testaufgabe beendet hat.
    },
    queue: {
        timing:
            Zeitpunkt vom Beginn in Millisekunden,
        size:
            ursprüngliche Anzahl von Testfällen,
        length:
            Anzahl ausstehenden Tests,
        progress:
            Anzahl durchgeführter Tests,
        lock:
            Indikator, wenn die Queue zur Ausführung eines Test wartet,
        faults:
            Anzahl der erkannten Fehler        
    }
}
```


## Output

Als Entwicklungswerkzeug stellen Browser eine Konsolenausgabe bereit, die zur
Protokollierung von Informationen verwendet werden kann.  
Die Protokollierung unterstützt verschiedene Kanäle bzw. Stufen (Level): LOG,
WARN, ERROR und INFO.

```javascript
console.log(message);
console.warn(message);
console.error(message);
console.info(message);
```

Um die Konsolenausgabe in Tests einbeziehen zu können, unterstützt das
aktivierte Test-API Weiterleitungen (Forwarding), Listener und Puffer (Buffer)
für die Konsolenausgabe.


### Forwarding

Das Forwarding läuft komplett im Hintergrund ab und verteilt die Ausgaben an die
Browser-Konsolenausgabe und an die Komponenten der Test-API. Bei (I)Frames wird
die Ausgabe an umschliessende bzw. übergeordnete Window-Objekte weitergeleitet
und ist dort mit aktiviertem Test-API per Buffer und Listener zugänglich.


### Buffer

Bei aktiviertem Test-API wird das JavaScript-API vom console-Objekt um den
Buffer output erweitert. Der Buffer enthält Zwischenspeicher für die Level: LOG,
WARN, ERROR und INFO sowie eine Methoden zum Leeren.

```javascript

var log   = console.output.log;
var warn  = console.output.warn;
var error = console.output.error;
var info  = console.output.info;

console.output.clear();
```


### Listener

Für die Konsolenausgabe können Callback-Methoden als Listener etabliert werden.

```javascript
console.listen(function(level, message) {
    message = Array.from(arguments).slice(1);
    ...
});
```

Die Callback-Methoden werden dann bei jeder Konsolenausgabe unter Angabe vom
Log-Level, das als erstes Parameter übergeben wird, aufgerufen. Die weitere
Anzahl von Parametern ist variable und abhängig vom initialen Aufruf der
korrespondierenden console-Methoden. Womit es oft einfacher ist `arguments` zu
verwenden.


### Monitoring

Das Monitoring überwacht den Testablauf während der Ausführung wird über die
verschiedenen Schritte und Status informiert. Der Monitor ist optional. Ohne
diesen werden Informationen zum Testverlauf in der Konsole ausgegeben.

Details zur Konfiguration und und Verwendung werden im Abschnitt
[Konfiguration - Monitor](#monitor) beschrieben.


### Control

Der Testverlauf und die Verarbeitung der einzelnen Tests kann per Test-API
gesteuert werden.

```javascript
Test.start();
Test.start(boolean);
});
```

(Neu)Start der Testausführung.  
Der Start kann manuell oder bei Verwendung von `auto = true` durch das Laden
der Seite erfolgen. Wenn die Seite bereits geladen ist, wird der Parameter
`auto` ignoriert und der Start sofort ausgeführt.

```javascript
Test.suspend();
});
```

Unterbricht die aktuelle Testausführung, die mit `Test.resume()` vom aktuellen
Test fortgesetzt werden kann.

```javascript
Test.resume();
});
```

Setzt die Testausführung fort, wenn sie zuvor unterbrochen wurde.

```javascript
Test.interrupt();
});
```

Unterbricht die aktuelle Testausführung und verwirft alle ausstehenden Tests.
Der Testlauf kann mit `Test.start()` neu gestartet werden.

```javascript
Test.status();
});
```

Macht eine Momentaufnahme des Status des aktuellen Tests.  
Der Status enthält Details zum aktuellen Test und zur Warteschlange. Die Details
sind schreibgeschützt und können nicht geändert werden. Wenn kein Test
ausgeführt wird, wird `false` zurückgegeben.

```javascript
{
    task: {
        title:
            Titel der Testaufgabe,
        meta:
            Meta-Informationen zum Test (name, test, timeout, expected,
            serial),
        running:
            Kennzeichen, wenn die Testaufgabe ausgeführt wird.
        timing:
            Zeitpunkt vom Beginn der Testaufgabe in Millisekunden.
        timeout:
            Optionale Zeit in Millisekunden, zu der ein Timeout
            erwartet wird.
        duration:
            Gesamtausführungszeit der Testaufgabe in Millisekunden nach
            dem Ende der Testaufgabe.
        error:
            Optional, wenn ein unerwarteter Fehler (auch Asser-Fehler)
            aufgetreten ist, der die Testaufgabe beendet hat.
    },
    queue: {
        timing:
            Zeitpunkt vom Beginn in Millisekunden,
        size:
            ursprüngliche Anzahl von Testfällen,
        length:
            Anzahl ausstehenden Tests,
        progress:
            Anzahl durchgeführter Tests,
        lock:
            Indikator, wenn die Queue zur Ausführung eines Test wartet,
        faults:
            Anzahl der erkannten Fehler        
    }
}
```


### Events

Ereignisse (Events) bzw. deren Callback-Methoden sind ein weitere Form zur
Überwachung der Testausführung. Die Callback-Methoden werden für entsprechende
Ereignisse vom Test-API registriert und funktionieren dann ähnlich dem Monitor.

List der verfügbaren Ereignisse:

```
Test.EVENT_INTERRUPT
Test.EVENT_PERFORM
Test.EVENT_RESPONSE
Test.EVENT_RESUME
Test.EVENT_START
Test.EVENT_SUSPEND
```

Beispiele zur Verwendung:
        
```javascript
Test.listen(Test.EVENT_START, function(event, status) {
    ...
});    
  
Test.listen(Test.EVENT_PERFORM, function(event, status) {
    ...
});      
  
Test.listen(Test.EVENT_FINISH, function(event, status) {
    ...
});      
```


- - -

[Erweiterung](extension.md) | [Inhalt](README.md#test)
