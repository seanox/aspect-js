"undefined"==typeof Namespace&&(window.Namespace={get PATTERN_NAMESPACE_SEPARATOR(){return/\./},get PATTERN_NAMESPACE(){return/^\w+(\.\w+)*$/i}},Namespace.locate=function(...e){let t,o;if(e.length<=0)return{scope:window};if(e.length>1)t=e[0],o=e[1];else{if(!(e.length>0))throw new TypeError("Invalid namespace");t=window,o=e[0]}if("object"!=typeof t)throw new TypeError("Invalid scope: "+typeof t);if("string"!=typeof o)throw new TypeError("Invalid namespace: "+typeof o);if(!o.match(Namespace.PATTERN_NAMESPACE)||t===window&&o.match(/^\d/))throw new Error("Invalid namespace"+(o.trim()?": "+o:""));return{scope:t,namespace:o}},Namespace.using=function(...e){if(e.length<=0)return window;const t=Namespace.locate(...e);return void 0===t.namespace?t.scope:(t.namespace.split(Namespace.PATTERN_NAMESPACE_SEPARATOR).forEach((e,o,r)=>{if(void 0===t.scope[e])o<r.length-1&&r[o+1].match(/^\d+$/)?t.scope[e]=[]:t.scope[e]={};else if(!(t.scope[e]instanceof Object||null===t.scope[e]))throw new Error("Invalid namespace: "+r.slice(0,o+1).join("."));t.scope=t.scope[e]}),t.scope)},Namespace.create=function(...e){if(e.length<1)throw new Error("Invalid namespace for creation: Namespace is missing");if(e.length<2)return Namespace.using(...e);const t=e.pop(),o=e.pop(),r=Namespace.using(...e);return r[o]=t,r[o]},Namespace.lookup=function(...e){if(e.length<=0)return window;const t=Namespace.locate(...e);if(void 0===t.namespace)return t.scope;if(t.namespace=t.namespace.split(Namespace.PATTERN_NAMESPACE_SEPARATOR),!t.namespace||t.namespace.length<=0)return null;for(let e=0;t.scope&&e<t.namespace.length;e++){if(!(t.namespace[e]in t.scope&&(t.scope[t.namespace[e]]instanceof Object||null===t.scope[t.namespace[e]])))return null;t.scope=t.scope[t.namespace[e]]}return t.scope},Namespace.exists=function(...e){return Object.usable(Namespace.lookup(...e))}),Element.prototype.appendChild$origin=Element.prototype.appendChild,Element.prototype.appendChild=function(e,t){if(t&&(this.innerHTML=""),e instanceof Node)this.appendChild$origin(e);else if(Array.isArray(e)||e instanceof NodeList||Symbol&&Symbol.iterator&&e&&(e[Symbol.iterator],1)){e=Array.from(e);for(let t=0;t<e.length;t++)this.appendChild$origin(e[t])}else this.appendChild$origin(e)},void 0===Math.uniqueId&&(Math.uniqueId=function(e){(e=e||16)<0&&(e=16);let t="";for(let o=0;o<e;o++){const e=Math.floor(Math.random()*Math.floor(26));Math.floor(Math.random()*Math.floor(26))%2==0?t+=String(e%10):t+=String.fromCharCode(65+e)}return t}),void 0===Math.uniqueSerialId&&(Math.uniqueSerialId=function(e){let t;return(e=e||16)<0&&(e=16),t=((t=((new Date).getTime()-9466848e5).toString(36)).length.toString(36)+t).toUpperCase(),(t=Math.uniqueId()+t).length>e&&(t=t.substr(t.length-e)),t}),void 0===RegExp.quote&&(RegExp.quote=function(e){return Object.usable(e)?String(e).replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&"):null}),void 0===String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.length<=0?this:this.charAt(0).toUpperCase()+this.slice(1)}),void 0===String.prototype.uncapitalize&&(String.prototype.uncapitalize=function(){return this.length<=0?this:this.charAt(0).toLowerCase()+this.slice(1)}),void 0===String.prototype.encodeHex&&(String.prototype.encodeHex=function(){let e="";for(let t=0;t<this.length;t++){let o=Number(this.charCodeAt(t)).toString(16).toUpperCase();for(;o.length<2;)o="0"+o;e+=o}return"0x"+e}),void 0===String.prototype.decodeHex&&(String.prototype.decodeHex=function(){let e=this;e.match(/^0x/)&&(e=e.substring(2));let t="";for(let o=0;o<e.length;o+=2)t+=String.fromCharCode(parseInt(e.substr(o,2),16));return t}),void 0===String.prototype.encodeBase64&&(String.prototype.encodeBase64=function(){try{return btoa(encodeURIComponent(this).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t)))}catch(e){throw new Error("malformed character sequence")}}),void 0===String.prototype.decodeBase64&&(String.prototype.decodeBase64=function(){try{return decodeURIComponent(atob(this).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(e){throw new Error("malformed character sequence")}}),void 0===String.prototype.encodeHtml&&(String.prototype.encodeHtml=function(){const e=document.createElement("div");return e.textContent=this,e.innerHTML}),void 0===String.prototype.hashCode&&(String.prototype.hashCode=function(){if(void 0===this.hash&&(this.hash=0),0!==this.hash)return this.hash;let e=0;for(let t=0;t<this.length;t++){const o=31*this.hash+this.charCodeAt(t);Number.isSafeInteger(o)?this.hash=o:(e++,this.hash=Number.MAX_SAFE_INTEGER-this.hash+this.charCodeAt(t))}return this.hash=Math.abs(this.hash),this.hash=this.hash.toString(36),this.hash=this.hash.length.toString(36)+this.hash,this.hash=this.hash+e.toString(36),this.hash=this.hash.toUpperCase(),this.hash}),void 0===String.prototype.unescape&&(String.prototype.unescape=function(){let text=this;return text=text.replace(/\r/g,"\\r"),text=text.replace(/\n/g,"\\n"),text=text.replace(/^(["'])/,"$1"),text=text.replace(/([^\\])((?:\\{2})*)(?=["'])/g,"$1$2\\"),eval('"'+text+'"')}),void 0===window.serial&&Object.defineProperty(window,"serial",{value:Math.uniqueSerialId()}),void 0===window.location.pathcontext&&Object.defineProperty(window.location,"pathcontext",{value:window.location.pathname.replace(/\/([^\/]*\.[^\/]*){0,}$/g,"")||"/"}),void 0===window.location.combine&&(window.location.combine=function(...e){return"/"+e.join("/").replace(/[\/\\]+/g,"/").replace(/(^\/+)|(\/+$)/g,"")}),"undefined"==typeof DataSource&&(window.DataSource={get DATA(){return window.location.combine(window.location.pathcontext,"/data")},get PATTERN_LOCATOR(){return/^(?:([a-z]+):\/+)(\/((\w+)|(\w+(\-+\w+)+)))+$/},get PATTERN_JAVASCRIPT(){return/^\s*text\s*\/\s*javascript\s*$/i},get PATTERN_WORD(){return/(^\w+$)|(^((\w+\-+(?=\w))+)\w*$)/},get ATTRIBUTE_TYPE(){return"type"},get locale(){return DataSource.locales?DataSource.locales.selection:null}},void 0===XMLDocument.prototype.clone&&(XMLDocument.prototype.clone=function(){const e=this.implementation.createDocument(null,null);return e.appendChild(e.importNode(this.documentElement,!0)),e}),function(){Object.defineProperty(DataSource,"cache",{value:{}}),Object.defineProperty(DataSource,"locales",{value:[],enumerable:!0});let e=[];if(e=e.concat(navigator.language),void 0!==navigator.languages&&(e=e.concat(navigator.languages)),Array.from(e).forEach(t=>{(t=t.match(/^[a-z]+/i,""))&&!e.includes(t[0])&&e.push(t[0])}),(e=(e=e.map(e=>e.trim().toLowerCase())).filter(function(t,o){return e.indexOf(t)===o})).length<=0)throw new Error("Locale not available");const t=new XMLHttpRequest;if(t.overrideMimeType("application/xslt+xml"),t.open("HEAD",DataSource.DATA+"/locales.xml",!1),t.send(),404===t.status)return;if(t.open("GET",DataSource.DATA+"/locales.xml",!1),t.send(),Object.defineProperty(DataSource,"data",{value:200===t.status?t.responseXML:null}),!DataSource.data&&404!==t.status)throw new Error("Locale not available");if(!DataSource.data)return;let o=DataSource.data,r=o.evaluate("/locales/*[@default]",o,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);for(let e=r.iterateNext();e;e=r.iterateNext()){let t=e.nodeName.toLowerCase();DataSource.locales.includes(t)||DataSource.locales.push(t)}for(let e=(r=o.evaluate("/locales/*",o,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null)).iterateNext();e;e=r.iterateNext()){const t=e.nodeName.toLowerCase();DataSource.locales.includes(t)||DataSource.locales.push(t)}if(DataSource.locales.length<=0)throw new Error("Locale not available");e.push(DataSource.locales[0]),e=e.filter(function(e){return DataSource.locales.includes(e)}),DataSource.locales.selection=e.length?e[0]:DataSource.locales[0]}(),DataSource.localize=function(e){if(!DataSource.data||!DataSource.locales)throw new Error("Locale not available");if("string"!=typeof e)throw new TypeError("Invalid locale: "+typeof e);if(!(e=(e||"").trim().toLowerCase())||!DataSource.locales.includes(e))throw new Error("Locale not available");DataSource.locales.selection=e},DataSource.transform=function(e,t,o){if("string"==typeof e&&e.match(DataSource.PATTERN_LOCATOR)&&(e=DataSource.fetch(e)),"string"==typeof t&&t.match(DataSource.PATTERN_LOCATOR)&&(t=DataSource.fetch(t)),!(e instanceof XMLDocument))throw new TypeError("Invalid xml document");if(!(t instanceof XMLDocument))throw new TypeError("Invalid xml stylesheet");const r=new XSLTProcessor;if(r.importStylesheet(t),o&&"object"==typeof o){const e="function"!=typeof o[Symbol.iterator]?Object.entries(o):o;for(const[t,n]of e)"function"!=typeof o[t]&&r.setParameter(null,t,n)}let n=e.evaluate("string(/*/@escape)",e,null,XPathResult.ANY_TYPE,null).stringValue;n=!!n.match(/^yes|on|true|1$/i);let s=r.transformToDocument(e.clone()),i=s.querySelectorAll(n?"*":"*[escape]");i.forEach(e=>{if(n||(e.getAttribute("escape")||"on").match(/^yes|on|true|1$/i)){const t=e.innerHTML;t.indexOf("<")<0&&t.indexOf(">")<0&&(e.innerHTML=e.textContent)}e.removeAttribute("escape")}),(i=s.querySelectorAll("script[type],script:not([type])")).forEach(e=>{e.hasAttribute(DataSource.ATTRIBUTE_TYPE)&&!(e.getAttribute(DataSource.ATTRIBUTE_TYPE)||"").match(DataSource.PATTERN_JAVASCRIPT)||e.setAttribute("type","composite/javascript")}),i=s.childNodes,s.body?i=s.body.childNodes:s.firstChild&&s.firstChild.nodeName.match(/^transformiix\b/i)&&(i=s.firstChild.childNodes);const a=document.createDocumentFragment();i=Array.from(i);for(let e=0;e<i.length;e++)a.appendChild(i[e]);return a},DataSource.fetch=function(e,t,o){if("string"!=typeof e||!e.match(DataSource.PATTERN_LOCATOR))throw new Error("Invalid locator: "+String(e));const r=e.match(DataSource.PATTERN_LOCATOR)[1],n=e.match(DataSource.PATTERN_LOCATOR)[2];if(1===arguments.length){DataSource.cache=DataSource.cache||{};let e=DataSource.DATA+"/"+DataSource.locale+"/"+n+"."+r;const t=(e=e.replace(/\/+/g,"/")).hashCode();if(DataSource.cache.hasOwnProperty(t))return DataSource.cache[t];const o=new XMLHttpRequest;if(o.overrideMimeType("application/xslt+xml"),o.open("GET",e,!1),o.send(),200!==o.status)throw new Error("HTTP status "+o.status+" for "+o.responseURL);return e=o.responseXML,DataSource.cache[t]=e,e.clone()}if(!r.match(/^xml$/)&&t)throw new Error("Transformation is not supported for this locator");const s=DataSource.fetch(e);if(!t)return s.clone();let i=e.replace(/(^((\w+\-+(?=\w))+)\w*)|(^\w+)/,"xslt");if("boolean"!=typeof t&&("string"!=typeof(i=t)||!i.match(DataSource.PATTERN_LOCATOR)))throw new Error("Invalid style: "+String(i));return DataSource.transform(s,DataSource.fetch(i),o)},DataSource.collect=function(...e){if(e.length<=0)return null;let t=[],o="collection";if(2===e.length&&"string"==typeof e[0]&&Array.isArray(e[1])){if(!e[0].match(DataSource.PATTERN_WORD))throw new TypeError("Invalid collector");o=e[0],t=Array.from(e[1])}else t=1===e.length&&Array.isArray(e[0])?t.concat(e[0]):Array.from(e);DataSource.cache=DataSource.cache||{};let r=o.hashCode()+":"+t.join().hashCode();if(t.forEach(e=>{r+=":"+String(e).hashCode()}),DataSource.cache.hasOwnProperty(r))return DataSource.cache[r].clone();const n=document.implementation.createDocument(null,o,null);return t.forEach(e=>{if("string"!=typeof e)throw new TypeError("Invalid collection entry");n.documentElement.appendChild(DataSource.fetch(e).documentElement.cloneNode(!0))}),DataSource.cache[r]=n,n.clone()}),"undefined"==typeof Messages&&(window.Messages={},function(){const e=DataSource.localize;DataSource.localize=(e=>{DataSource.localize$origin(e),window.Messages={};const t="/locales/"+DataSource.locale+"/label",o=DataSource.data.evaluate(t,DataSource.data,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);for(let e=o.iterateNext();e;e=o.iterateNext()){const t=(e.getAttribute("key")||"").trim();if(""===t)continue;let o=((e.getAttribute("value")||"").trim()+" "+e.textContent.trim()).trim();o=o.unescape(),Messages.hasOwnProperty(t)||Object.defineProperty(Messages,t,{value:o})}}),DataSource.localize$origin=e,DataSource.data&&DataSource.locale&&DataSource.locales&&DataSource.locales.includes(DataSource.locale)&&DataSource.localize(DataSource.locale)}()),"undefined"==typeof Composite&&(window.Composite={get MODULES(){return window.location.combine(window.location.pathcontext,"/modules")},get ATTRIBUTE_COMPOSITE(){return"composite"},get ATTRIBUTE_CONDITION(){return"condition"},get ATTRIBUTE_EVENTS(){return"events"},get ATTRIBUTE_ID(){return"id"},get ATTRIBUTE_IMPORT(){return"import"},get ATTRIBUTE_INTERVAL(){return"interval"},get ATTRIBUTE_ITERATE(){return"iterate"},get ATTRIBUTE_MESSAGE(){return"message"},get ATTRIBUTE_NOTIFICATION(){return"notification"},get ATTRIBUTE_NAME(){return"name"},get ATTRIBUTE_OUTPUT(){return"output"},get ATTRIBUTE_RENDER(){return"render"},get ATTRIBUTE_RELEASE(){return"release"},get ATTRIBUTE_STRICT(){return"strict"},get ATTRIBUTE_TEXT(){return"text"},get ATTRIBUTE_TYPE(){return"type"},get ATTRIBUTE_VALIDATE(){return"validate"},get ATTRIBUTE_VALUE(){return"value"},get PATTERN_ATTRIBUTE_ACCEPT(){return/^(composite|condition|events|id|import|interval|iterate|message|notification|output|release|render|strict|validate)$/i},get PATTERN_ATTRIBUTE_STATIC(){return/^(composite|id)$/i},get PATTERN_EXPRESSION_CONTAINS(){return/\{\{(.|\r|\n)*?\}\}/g},get PATTERN_EXPRESSION_CONDITION(){return/^\s*\{\{\s*(([^}]|(}(?!})))*?)\s*\}\}\s*$/i},get PATTERN_EXPRESSION_VARIABLE(){return/^\s*\{\{\s*((?:(?:_*[a-z])|(?:_\w*))\w*)\s*:\s*(([^}]|(}(?!})))*?)\s*\}\}\s*$/i},get PATTERN_ELEMENT_IGNORE(){return/script|style/i},get PATTERN_SCRIPT(){return/script/i},get PATTERN_COMPOSITE_SCRIPT(){return/^composite\/javascript$/i},get PATTERN_COMPOSITE_ID(){return/(^\w+$)|(^((\w+\-+(?=\w))+)\w*$)/},get PATTERN_ELEMENT_ID(){return/^((?:(?:(?:\w+\-+(?=\w))+)\w*)|(?:\w+))((\:((((\w+\-+(?=\w))+)\w*)|(\w+)))*)$/},get PATTERN_CUSTOMIZE_SCOPE(){return/(^\w+$)|(^((\w+\-+(?=\w))+)\w*$)/},get PATTERN_NAMESPACE_SEPARATOR(){return/[\.:]/g},get PATTERN_NAMESPACE(){return/^\w+(\.\w+)*(\:\w+)*$/i},get PATTERN_DATASOURCE_URL(){return/^\s*xml:\s*(\/[^\s]+)\s*(?:\s*(?:xslt|xsl):\s*(\/[^\s]+))*$/i},get PATTERN_EVENT(){return/^([A-Z][a-z]+)+$/},get EVENT_RENDER_START(){return"RenderStart"},get EVENT_RENDER_NEXT(){return"RenderNext"},get EVENT_RENDER_END(){return"RenderEnd"},get EVENT_MOUNT_START(){return"MountStart"},get EVENT_MOUNT_NEXT(){return"MountNext"},get EVENT_MOUNT_END(){return"MountEnd"},get EVENT_HTTP_START(){return"HttpStart"},get EVENT_HTTP_PROGRESS(){return"HttpProgress"},get EVENT_HTTP_RECEIVE(){return"HttpReceive"},get EVENT_HTTP_LOAD(){return"HttpLoad"},get EVENT_HTTP_ABORT(){return"HttpAbort"},get EVENT_HTTP_TIMEOUT(){return"HttpTimeout"},get EVENT_HTTP_ERROR(){return"HttpError"},get EVENT_HTTP_END(){return"HttpEnd"},get EVENT_ERROR(){return"Error"},get events(){return"abort after|print animation|end animation|iteration animation|start before|print before|unload blur can|play can|play|through change click context|menu copy cut dbl|click drag drag|end drag|enter drag|leave drag|over drag|start drop duration|change ended error focus focus|in focus|out hash|change input invalid key|down key|press key|up load loaded|data loaded|meta|data load|start message mouse|down mouse|enter mouse|leave mouse|move mouse|over mouse|out mouse|up mouse|wheel offline online open page|hide page|show paste pause play playing popstate progress rate|change resize reset scroll search seeked seeking select show stalled storage submit suspend time|update toggle touch|cancel touch|end touch|move touch|start transition|end unload volume|change waiting wheel"},get PATTERN_EVENT_FUNCTIONS(){return function(){const e=Composite.events.replace(/(?:\||\b)(\w)/g,(e,t)=>t.toUpperCase());return new RegExp("^on("+e.replace(/\s+/g,"|")+")")}()},get PATTERN_EVENT_NAMES(){return Composite.events.replace(/(?:\||\b)(\w)/g,(e,t)=>t.toUpperCase()).split(/\s+/)},get PATTERN_EVENT_FILTER(){return Composite.events.replace(/(?:\||\b)(\w)/g,(e,t)=>t.toUpperCase()).toLowerCase().split(/\s+/)}},Object.defineProperty(Composite,"statics",{value:new Set}),Object.defineProperty(Composite,"macros",{value:new Map}),Object.defineProperty(Composite,"selectors",{value:new Map}),Object.defineProperty(Composite,"acceptors",{value:new Set}),Object.defineProperty(Composite,"listeners",{value:new Map}),Object.defineProperty(Composite,"models",{value:new Set}),Composite.lock=function(e,t){if(e.queue=e.queue||[],void 0===e.lock||!1===e.lock)if(e.lock={ticks:1,selector:t,queue:[],share(){return this.ticks++,this},release(){if(this.ticks--,this.ticks>0)return;if(e===Composite.render){let e=[];if("string"==typeof this.selector){const t=document.querySelectorAll(this.selector);Array.from(t).forEach(t=>{e.includes(t)||e.push(t);const o=t.querySelectorAll("*");Array.from(o).forEach(t=>{e.includes(t)||e.push(t)})})}else this.selector instanceof Element&&(e=this.selector.querySelectorAll("*"),e=[this.selector].concat(Array.from(e)));e.forEach(e=>{Composite.mount(e)}),Composite.fire(Composite.EVENT_RENDER_END,this.selector)}else{if(e!==Composite.mount)throw new Error("Invalid context: "+e);Composite.fire(Composite.EVENT_MOUNT_END,this.selector)}const t=e.queue.shift();t&&Composite.asynchron(e,t),e.lock=!1}},e===Composite.render)Composite.fire(Composite.EVENT_RENDER_START,this.selector);else{if(e!==Composite.mount)throw new Error("Invalid context: "+e);Composite.fire(Composite.EVENT_MOUNT_START,this.selector)}else if(e===Composite.render)Composite.fire(Composite.EVENT_RENDER_NEXT,this.selector);else{if(e!==Composite.mount)throw new Error("Invalid context: "+e);Composite.fire(Composite.EVENT_MOUNT_NEXT,this.selector)}return e.lock},void 0===Object.indication&&(Object.indication=0),void 0===Object.prototype.ordinal&&(Object.prototype.ordinal=function(){return this.serial=this.serial||++Object.indication,this.serial}),void 0===Object.locate&&(Object.locate=function(...e){let t,o;if(0===e.length)return{scope:window};if(e.length>1)t=e[0],o=e[1];else{if(!(e.length>0))throw new TypeError("Invalid namespace");t=window,o=e[0]}if("object"!=typeof t)throw new TypeError("Invalid scope: "+typeof t);if("string"!=typeof o)throw new TypeError("Invalid namespace: "+typeof o);if(!o.match(Composite.PATTERN_NAMESPACE)||t===window&&o.match(/^\d/))throw new Error("Invalid namespace"+(o.trim()?": "+o:""));return{scope:t,namespace:o=o.replace(Composite.PATTERN_NAMESPACE_SEPARATOR,".")}}),void 0===Object.using&&(Object.using=function(...e){const t=Object.locate(...e);return void 0===t.namespace?t.scope:Namespace.using.call(null,t.scope,t.namespace)}),void 0===Object.lookup&&(Object.lookup=function(...e){const t=Object.locate(...e);return void 0===t.namespace?t.scope:Namespace.lookup.call(null,t.scope,t.namespace)}),void 0===Object.exists&&(Object.exists=function(...e){return null!==Object.lookup(...e)}),void 0===Object.usable&&(Object.usable=function(e){return null!=e}),XMLHttpRequest.prototype.open$origin=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(...e){const t=(e=null)=>{if(e){if("loadstart"===e.type)e=[Composite.EVENT_HTTP_START,e];else if("progress"===e.type)e=[Composite.EVENT_HTTP_PROGRESS,e];else if("readystatechange"===e.type)e=[Composite.EVENT_HTTP_RECEIVE,e];else if("load"===e.type)e=[Composite.EVENT_HTTP_LOAD,e];else if("abort"===e.type)e=[Composite.EVENT_HTTP_ABORT,e];else if("error"===e.type)e=[Composite.EVENT_HTTP_ERROR,e];else if("timeout"===e.type)e=[Composite.EVENT_HTTP_TIMEOUT,e];else{if("loadend"!==e.type)return;e=[Composite.EVENT_HTTP_END,e]}Composite.fire(...e)}};void 0===this.open$init&&(this.open$init=!0,this.addEventListener("loadstart",t),this.addEventListener("progress",t),this.addEventListener("readystatechange",t),this.addEventListener("load",t),this.addEventListener("abort",t),this.addEventListener("error",t),this.addEventListener("timeout",t),this.addEventListener("loadend",t)),this.open$origin(...e)},Composite.listen=function(e,t){if("string"!=typeof e)throw new TypeError("Invalid event: "+typeof e);if("function"!=typeof t&&null!=t)throw new TypeError("Invalid callback: "+typeof t);if(!e.match(Composite.PATTERN_EVENT))throw new Error("Invalid event"+(e.trim()?": "+e:""));e=e.toLowerCase(),Composite.listeners.has(e)&&Array.isArray(Composite.listeners.get(e))||Composite.listeners.set(e,[]),Composite.listeners.get(e).push(t)},Composite.fire=function(e,...t){if(e=(e||"").trim(),Composite.listeners.size<=0||!e)return;const o=Composite.listeners.get(e.toLowerCase());Array.isArray(o)&&(t=[e,...t],o.forEach(e=>{e(...t)}))},Composite.asynchron=function(e,...t){window.setTimeout((e,...t)=>{e(...t)},0,e,...t)},Composite.validate=function(e,t){if((arguments.length<2||!1!==t)&&(t=!0),"string"==typeof e){if(!(e=e.trim()))return;let o=Array.from(document.querySelectorAll(e));return o.forEach((e,r)=>{o[r]=Composite.validate(e,t),void 0===o[r]?o[r]=0:o[r]=!0===o[r]?1:2}),!!(o=o.join("")).match(/^1+$/)||!o.match(/2/)&&void 0}if(!(e instanceof Element))return;const o=e.ordinal(),r=Composite.render.meta[o];let n=!0;const s=Composite.mount.lookup(e);if(!(s instanceof Object))return;let i;if("function"==typeof e.setCustomValidity&&e.setCustomValidity(""),"function"==typeof e.checkValidity&&(n=e.checkValidity()),e instanceof Element&&(e.tagName.match(/^input$/i)&&e.type.match(/^radio|checkbox/i)?i=e.checked:e.tagName.match(/^select/i)&&"selectedIndex"in e?i=e.options[e.selectedIndex].value:Composite.ATTRIBUTE_VALUE in e&&(i=e[Composite.ATTRIBUTE_VALUE])),r.attributes.hasOwnProperty(Composite.ATTRIBUTE_VALIDATE)&&!0===n&&!0!==t&&"function"==typeof s.model[Composite.ATTRIBUTE_VALIDATE]){const t=s.model[Composite.ATTRIBUTE_VALIDATE];n=void 0!==i?t.call(s.model,e,i):t.call(s.model,e)}if(!0!==n){let t;"string"==typeof n&&n.trim()&&(t=n.trim()),"string"!=typeof t&&(r.attributes.hasOwnProperty(Composite.ATTRIBUTE_MESSAGE)&&(t=String(r.attributes[Composite.ATTRIBUTE_MESSAGE]||"")),(t||"").match(Composite.PATTERN_EXPRESSION_CONTAINS)&&(t=String(Expression.eval(o+":"+Composite.ATTRIBUTE_MESSAGE,t)))),"function"==typeof e.setCustomValidity&&Object.usable(t)&&(e.setCustomValidity(t),r.attributes.hasOwnProperty(Composite.ATTRIBUTE_NOTIFICATION)&&"function"==typeof e.reportValidity&&e.reportValidity())}return void 0!==n?n:void 0},Composite.mount=function(e,t){if(Composite.mount.queue=Composite.mount.queue||[],Composite.mount.lock&&Composite.mount.lock!==t)Composite.mount.queue.includes(e)||Composite.mount.queue.push(e);else{t=Composite.lock(Composite.mount,e);try{if("string"==typeof e){if(!(e=e.trim()))return;return void document.querySelectorAll(e).forEach(e=>{Composite.mount(e,t.share())})}if(!(e instanceof Element)||Composite.mount.queue.includes(e)||e.nodeName.match(Composite.PATTERN_ELEMENT_IGNORE))return;if(Composite.mount.stack=Composite.mount.stack||[],Composite.mount.stack.includes(e))return;const o=e.ordinal(),r=Composite.render.meta[o];if(!(r instanceof Object))return;let n=r.attributes.hasOwnProperty(Composite.ATTRIBUTE_EVENTS)?r.attributes[Composite.ATTRIBUTE_EVENTS]:"";n=(n=(n=String(n||"")).toLowerCase().split(/\s+/)).filter((e,t,o)=>Composite.PATTERN_EVENT_FILTER.includes(e)&&o.indexOf(e)===t);const s=Composite.mount.lookup(e);if(s instanceof Object){let e=s.model;void 0!==s.property&&(e="object"==typeof s.property?s.property:null);for(let t in e)"function"==typeof e[t]&&t.match(Composite.PATTERN_EVENT_FUNCTIONS)&&(t=t.substring(2).toLowerCase(),n.includes(t)||n.push(t));let t=e?Object.getPrototypeOf(e):null;for(;t;)Object.getOwnPropertyNames(t).forEach(t=>{"function"==typeof e[t]&&t.match(Composite.PATTERN_EVENT_FUNCTIONS)&&(t=t.substring(2).toLowerCase(),n.includes(t)||n.push(t))}),t=Object.getPrototypeOf(t)}Composite.mount.stack.push(e),n.forEach(t=>{e.addEventListener(t.toLowerCase(),e=>{const t=e.currentTarget,o=t.ordinal(),r=Composite.render.meta[o];let n,s=e.type.toLowerCase();if(!Composite.PATTERN_EVENT_FILTER.includes(s))return;s=Composite.PATTERN_EVENT_FILTER.indexOf(s),s=Composite.PATTERN_EVENT_NAMES[s];let i=!0;const a=Composite.mount.lookup(t);if(a instanceof Object){let o;if(t instanceof Element&&(t.tagName.match(/^input$/i)&&t.type.match(/^radio|checkbox/i)?o=t.checked:t.tagName.match(/^select/i)&&"selectedIndex"in t?o=t.options[t.selectedIndex].value:Composite.ATTRIBUTE_VALUE in t&&(o=t[Composite.ATTRIBUTE_VALUE])),!0===(i=Composite.validate(t,!1))){const t=e=>{const t=typeof e;return void 0!==e&&("object"===t&&null===e||("boolean"===t||"number"===t||"string"===t))};t(a.property)?a.property=o:"object"==typeof a.property?t(a.property.value)&&(a.property.value=o):void 0===a.property&&t(a.model.value)&&(a.model.value=o);let r=a.model;void 0!==a.property&&(r=a.property&&"object"==typeof a.property?a.property:null),r&&"function"==typeof r["on"+s]&&(n=r["on"+s].call(r,e))}}let c=r.attributes.hasOwnProperty(Composite.ATTRIBUTE_EVENTS)?r.attributes[Composite.ATTRIBUTE_EVENTS]:"";if((c=(c=String(c||"")).toLowerCase().split(/\s+/)).includes(s.toLowerCase())){let e=r.attributes.hasOwnProperty(Composite.ATTRIBUTE_RENDER)?r.attributes[Composite.ATTRIBUTE_RENDER]:"";((e=String(e||""))||"").match(Composite.PATTERN_EXPRESSION_CONTAINS)&&(e=Expression.eval(o+":"+Composite.ATTRIBUTE_RENDER,e)),Composite.render(e)}return a instanceof Object&&((void 0!==n&&!n||void 0!==i&&!0!==i)&&e.preventDefault(),void 0!==n)?n:void 0})})}finally{t.release()}}},Composite.mount.locate=function(e){if(!(e instanceof Element))return null;let t=(e.getAttribute(Composite.ATTRIBUTE_ID)||"").trim();if(e.hasAttribute(Composite.ATTRIBUTE_COMPOSITE)){if(t.match(Composite.PATTERN_COMPOSITE_ID))return{composite:t,model:t};throw new Error("Invalid composite id"+(t?": "+t:""))}const o={composite:null,model:null,property:null,name:null};(t=t.match(Composite.PATTERN_ELEMENT_ID))&&(t[1]&&(o.property=t[1]),t[2]&&(o.name=t[2].replace(/(^:+)|(:+$)/g,"")));for(let t=e.parentNode;t;t=t.parentNode){if(!(t instanceof Element&&t.hasAttribute(Composite.ATTRIBUTE_ID)))continue;let e=(t.getAttribute(Composite.ATTRIBUTE_ID)||"").trim();if(!e.match(Composite.PATTERN_ELEMENT_ID))throw new Error("Invalid element id"+(e?": "+e:""));if(o.model?o.model=e+"."+o.model:o.model=e,t.hasAttribute(Composite.ATTRIBUTE_COMPOSITE)){if(!e.match(Composite.PATTERN_COMPOSITE_ID))throw new Error("Invalid composite id"+(e?": "+e:""));o.composite=e;break}}return o.composite?(o.name||delete o.name,o):null},Composite.mount.lookup=function(e){if(!(e instanceof Element))return null;const t=Composite.mount.locate(e);if(!t)return null;let o={meta:t,composite:Object.lookup(t.composite),model:Object.lookup(t.model)};if(!o.composite||!o.model)return null;if(void 0===t.property)return o;if(t.name){const e=(t.property+"."+t.name.replace(/\:/g,".")).match(/^(.*)\.(\w+)$/);t.property=e[1],t.name=e[2]}return(o={meta:t,composite:Object.lookup(t.composite),model:Object.lookup(t.model),get property(){if(this.meta.name){const e=Object.lookup(this.model,this.meta.property);if(null===e)return;return e[this.meta.name]}return this.model[this.meta.property]},set property(e){this.meta.name?Object.lookup(this.model,this.meta.property)[this.meta.name]=e:this.model[this.meta.property]=e}}).composite&&o.model&&void 0!==o.property?o:null},Composite.customize=function(...e){let t;if(e.length>0&&(t=e[0]),"string"==typeof t&&e.length>1&&"string"==typeof e[1]&&t.match(/^@ATTRIBUTES-STATICS$/i)){const t=[];(e[1]||"").trim().split(/\s+/).forEach(e=>{e=e.toLowerCase(),Composite.statics.has(e)||e.match(Composite.PATTERN_ATTRIBUTE_ACCEPT)||(Composite.statics.add(e),t.push(e))});const o=e=>{if(!(e instanceof Element))return;const r=e.ordinal(),n=Composite.render.meta[r];n&&(t.forEach(t=>{n.statics=n.statics||{},n.statics.hasOwnProperty[t]&&void 0!==n.statics[t]||(e.hasAttribute(t)?n.statics[t]=e.getAttribute(t):n.statics[t]=null)}),Array.from(e.childNodes).forEach(e=>{o(e)}))};return void o(document.body)}if("function"==typeof t&&1===e.length)return void Composite.acceptors.add(t);if("string"!=typeof t)throw new TypeError("Invalid scope: "+typeof t);const o=e.length>1?e[1]:null;if("function"!=typeof o&&null!=o)throw new TypeError("Invalid callback: "+typeof o);if((t=t.trim()).length<=0)throw new Error("Invalid scope");if(t.match(Composite.PATTERN_CUSTOMIZE_SCOPE))null===o?Composite.macros.delete(t.toLowerCase()):Composite.macros.set(t.toLowerCase(),o);else{const e=t.toLowerCase().hashCode();null===o?Composite.selectors.delete(e):Composite.selectors.set(e,{selector:t,callback:o})}},Composite.render=function(e,t){if(e)if(Composite.render.queue=Composite.render.queue||[],Composite.render.lock&&Composite.render.lock!==t)Composite.render.queue.includes(e)||Composite.render.queue.push(e);else{t=Composite.lock(Composite.render,e);try{if("string"==typeof e){if(!(e=e.trim()))return;return void document.querySelectorAll(e).forEach(e=>{Composite.render(e,t.share())})}if(!(e instanceof Node))return;const o=Composite.macros.get(e.nodeName.toLowerCase());if(o&&!1===o(e))return;if(e.parentNode)for(const[t,o]of Composite.selectors){const t=e.parentNode.querySelectorAll(o.selector);if(Array.from(t).includes(e)&&!1===o.callback(e))return}Composite.render.meta=Composite.render.meta||[];let r=e.ordinal(),n=Composite.render.meta[r];if(!n&&(Composite.acceptors.forEach(t=>{t.call(null,e)}),n={serial:r,element:e,attributes:{}},Composite.render.meta[r]=n,e instanceof Element&&e.attributes)){Array.from(e.attributes).forEach(t=>{((t={name:t.name.toLowerCase(),value:(t.value||"").trim()}).value.match(Composite.PATTERN_EXPRESSION_CONTAINS)||t.name.match(Composite.PATTERN_ATTRIBUTE_ACCEPT)||Composite.statics.has(t.name))&&(!t.name.match(Composite.PATTERN_ATTRIBUTE_ACCEPT)||t.name.match(Composite.PATTERN_ATTRIBUTE_STATIC)||Composite.statics.has(t.name)||t.name===Composite.ATTRIBUTE_RELEASE||e.removeAttribute(t.name),n.attributes[t.name]=t.value,t.value.match(Composite.PATTERN_EXPRESSION_CONTAINS)&&(t.name.match(Composite.PATTERN_ATTRIBUTE_STATIC)||t.name===Composite.ATTRIBUTE_ID||t.name===Composite.ATTRIBUTE_EVENTS||Composite.statics.has(t.name))&&(t.value=Expression.eval(e.ordinal()+":"+t.name,t.value)),(t.name.match(Composite.PATTERN_ATTRIBUTE_STATIC)||t.name===Composite.ATTRIBUTE_ID||t.name===Composite.ATTRIBUTE_EVENTS)&&(n.attributes[t.name]=t.value),n.statics=n.statics||{},Composite.statics.has(t.name)&&(n.statics[t.name]=t.value),(t.name.match(Composite.PATTERN_ATTRIBUTE_STATIC)||t.name===Composite.ATTRIBUTE_ID||t.name===Composite.ATTRIBUTE_EVENTS||Composite.statics.has(t.name))&&e.setAttribute(t.name,t.value))});const t=n.attributes.hasOwnProperty(Composite.ATTRIBUTE_CONDITION)?n.attributes[Composite.ATTRIBUTE_CONDITION]:null;if(delete n.attributes[Composite.ATTRIBUTE_CONDITION],t){delete n.attributes[Composite.ATTRIBUTE_CONDITION];const o=document.createTextNode("");n={serial:o.ordinal(),element:o,attributes:n.attributes,condition:t,template:e.cloneNode(!0),output:null,complete:!1,share:null},Composite.render.meta[n.serial]=n,delete Composite.render.meta[r],e.parentNode.replaceChild(o,e),r=(e=o).ordinal(),n=Composite.render.meta[r]}else n.attributes.hasOwnProperty(Composite.ATTRIBUTE_COMPOSITE)&&Composite.render.include(e)}if(n.hasOwnProperty("placeholder"))return Composite.render(n.placeholder.element,t.share()),e=n.placeholder.element,r=e.ordinal(),void(n=Composite.render.meta[r]);if(e.nodeType===Node.TEXT_NODE&&!n.hasOwnProperty(Composite.ATTRIBUTE_CONDITION)){if(e.parentNode&&e.parentNode.nodeName.match(Composite.PATTERN_ELEMENT_IGNORE))return;if(n.attributes.hasOwnProperty(Composite.ATTRIBUTE_TEXT))return;if(n.attributes.hasOwnProperty(Composite.ATTRIBUTE_VALUE))return void n.render();let t=e.textContent;if(t.match(Composite.PATTERN_EXPRESSION_CONTAINS)){if((t=t.replace(Composite.PATTERN_EXPRESSION_CONTAINS,e=>{if(!e.substring(2,e.length-2).trim())return"";const t=document.createTextNode(""),o=t.ordinal(),r={serial:o,element:t,attributes:{},value:null,render(){let e="";if(this.attributes.hasOwnProperty(Composite.ATTRIBUTE_NAME)){const e=String(this.attributes[Composite.ATTRIBUTE_NAME]||"").trim(),t=String(this.attributes[Composite.ATTRIBUTE_VALUE]||"").trim();window[e]=Expression.eval(this.serial+":"+Composite.ATTRIBUTE_VALUE,t)}else e=String(this.attributes[Composite.ATTRIBUTE_VALUE]||""),e=Expression.eval(this.serial+":"+Composite.ATTRIBUTE_VALUE,e);this.value=e,this.element.textContent=e}},n=e.match(Composite.PATTERN_EXPRESSION_VARIABLE);return n?(r.attributes[Composite.ATTRIBUTE_NAME]=n[1],r.attributes[Composite.ATTRIBUTE_VALUE]="{{"+n[2]+"}}"):r.attributes[Composite.ATTRIBUTE_VALUE]=e,Composite.render.meta[o]=r,"{{"+o+"}}"})).match(Composite.PATTERN_EXPRESSION_CONTAINS)){const o=t.split(/(\{\{\d+\}\})/);if(o.forEach((e,t,o)=>{if(e.match(/^\{\{\d+\}\}$/)){const r=parseInt(e.substring(2,e.length-2).trim()),n=Composite.render.meta[r];n.render(),o[t]=n.element}else{const r=document.createTextNode(e),n=r.ordinal(),s={serial:n,element:r,attributes:{}};s.element.textContent=e,s.attributes[Composite.ATTRIBUTE_TEXT]=e,Composite.render.meta[n]=s,o[t]=s.element}}),null===e.parentNode)return;return o.forEach(t=>{e.parentNode.insertBefore(t,e)}),void e.parentNode.removeChild(e)}e.nodeValue=t}return void(n.attributes[Composite.ATTRIBUTE_TEXT]=t)}const s=e=>{if(!(e instanceof Element))return null;let t=document.createElement("div"),o=t;for(;e;e=e.parentNode){if(!(e instanceof Element&&e.hasAttribute(Composite.ATTRIBUTE_ID)))continue;const t=document.createElement("div");t.setAttribute(Composite.ATTRIBUTE_ID,e.getAttribute(Composite.ATTRIBUTE_ID)),e.hasAttribute(Composite.ATTRIBUTE_COMPOSITE)&&t.setAttribute(Composite.ATTRIBUTE_COMPOSITE,""),t.appendChild(o),o=t}return t},i=e=>{"string"!=typeof e||Composite.models.has(e)||(Composite.models.add(e),(e=Object.lookup(e))&&"function"==typeof e.dock&&e.dock.call(e))};if(e instanceof Element&&n.attributes.hasOwnProperty(Composite.ATTRIBUTE_COMPOSITE)){const e=String(n.attributes[Composite.ATTRIBUTE_ID]||"").trim();if(!e.match(Composite.PATTERN_COMPOSITE_ID))throw new Error("Invalid composite id"+(e?": "+e:""));i(e)}if(e.nodeType===Node.TEXT_NODE&&n.hasOwnProperty(Composite.ATTRIBUTE_CONDITION)){const o=n;if(o.share===t.ordinal())return;if(o.share=t.ordinal(),!o.condition||!o.condition.match(Composite.PATTERN_EXPRESSION_CONDITION)||!0!==Expression.eval(r+":"+Composite.ATTRIBUTE_CONDITION,o.condition)){const t=(o.condition||"").trim();if(t.match(Composite.PATTERN_EXPRESSION_CONDITION)||console.error("Invalid condition"+(t?": "+t:"")),!o.output)return;return e.parentNode.removeChild(o.output),void delete o.output}if(!o.complete){if(o.attributes.hasOwnProperty(Composite.ATTRIBUTE_COMPOSITE)){const e=o.template.ordinal(),t={serial:e,element:o.template,attributes:o.attributes,share:null};Composite.render.meta[e]=t,Composite.render.include(o.template),delete Composite.render.meta[e]}o.complete=!0}if(o.attributes.hasOwnProperty(Composite.ATTRIBUTE_COMPOSITE)){const e=String(o.attributes[Composite.ATTRIBUTE_ID]||"").trim();if(!e.match(Composite.PATTERN_COMPOSITE_ID))throw new Error("Invalid composite id"+(e?": "+e:""));i(e)}if(!o.output){const r=o.template.cloneNode(!0);s(e.parentNode).appendChild(r),o.output=r;const i=r.ordinal(),a={serial:i,element:r,attributes:n.attributes};return Composite.render.meta[i]=a,Composite.render(r,t.share()),a.placeholder=o,void e.parentNode.insertBefore(r,e)}e=o.output,r=e.ordinal(),n=Composite.render.meta[r]}if(!(e instanceof Element))return;if(n.attributes.hasOwnProperty(Composite.ATTRIBUTE_IMPORT)){e.innerHTML="";let o=n.attributes[Composite.ATTRIBUTE_IMPORT];if((o||"").match(Composite.PATTERN_EXPRESSION_CONTAINS)&&(o=Expression.eval(r+":"+Composite.ATTRIBUTE_IMPORT,String(o))),Composite.render.cache=Composite.render.cache||{},o)if(o instanceof Element||o instanceof NodeList)e.appendChild(o,!0),delete n.attributes[Composite.ATTRIBUTE_IMPORT];else if(String(o).match(Composite.PATTERN_DATASOURCE_URL)){let t=String(o).match(Composite.PATTERN_DATASOURCE_URL);t[2]=DataSource.fetch("xslt://"+(t[2]||t[1])),t[1]=DataSource.fetch("xml://"+t[1]),t=DataSource.transform(t[1],t[2]),e.appendChild(t,!0);const r=e.ordinal();delete Composite.render.meta[r].attributes[Composite.ATTRIBUTE_IMPORT]}else if(void 0!==Composite.render.cache[o]){e.innerHTML=Composite.render.cache[o];const t=e.ordinal();delete Composite.render.meta[t].attributes[Composite.ATTRIBUTE_IMPORT]}else Composite.asynchron((e,t,o)=>{try{const r=new XMLHttpRequest;if(r.overrideMimeType("text/plain"),r.open("GET",o,!1),r.send(),200!==r.status)throw new Error("HTTP status "+r.status+" for "+r.responseURL);const n=r.responseText.trim();Composite.render.cache[r.responseURL]=n,e.innerHTML=n;const s=e.ordinal();delete Composite.render.meta[s].attributes[Composite.ATTRIBUTE_IMPORT]}catch(e){throw Composite.fire(Composite.EVENT_HTTP_ERROR,e),e}finally{t.release()}},e,t.share(),o);else delete n.attributes[Composite.ATTRIBUTE_IMPORT]}if(n.attributes.hasOwnProperty(Composite.ATTRIBUTE_OUTPUT)){e.innerHTML="";let t=n.attributes[Composite.ATTRIBUTE_OUTPUT];if((t||"").match(Composite.PATTERN_EXPRESSION_CONTAINS)&&(t=Expression.eval(r+":"+Composite.ATTRIBUTE_OUTPUT,String(t))),String(t).match(Composite.PATTERN_DATASOURCE_URL)){let o=String(t).match(Composite.PATTERN_DATASOURCE_URL);o[2]=DataSource.fetch("xslt://"+(o[2]||o[1])),o[1]=DataSource.fetch("xml://"+o[1]),o=DataSource.transform(o[1],o[2]),e.appendChild(o,!0)}else t instanceof Node?e.appendChild(t.cloneNode(!0),!0):t instanceof NodeList?Array.from(t).forEach(function(t,o){e.appendChild(t.cloneNode(!0),0===o)}):e.innerHTML=String(t)}let a=String(n.attributes[Composite.ATTRIBUTE_INTERVAL]||"").trim();if(a&&!n.interval){const t=r+":"+Composite.ATTRIBUTE_INTERVAL;(a=String(Expression.eval(t,a))).match(/^\d+$/)?(n.hasOwnProperty("placeholder")&&(n=n.placeholder,e=n.element),a=parseInt(a),n.interval={object:n,selector:e,task(e){const t=e.selector.ordinal(),o=Composite.render.meta[t];let r=!document.body.contains(e.selector);o||(r=!0),!o||!o.hasOwnProperty(Composite.ATTRIBUTE_CONDITION)||o.condition.element&&document.body.contains(o.condition.element)||(r=!0),r?(window.clearInterval(e.timer),delete e.object.interval):Composite.render(e.selector)}},n.interval.timer=window.setInterval(n.interval.task,a,n.interval)):a&&console.error("Invalid interval: "+a)}if(n.attributes.hasOwnProperty(Composite.ATTRIBUTE_ITERATE)){if(!n.iterate){const t=String(n.attributes[Composite.ATTRIBUTE_ITERATE]||"").trim(),o=t.match(Composite.PATTERN_EXPRESSION_VARIABLE);o?(n.iterate={name:o[1].trim(),expression:"{{"+o[2].trim()+"}}"},n.template=e.cloneNode(!0)):console.error("Invalid iterate"+(t?": "+t:""))}if(n.iterate){const o=window[n.iterate.name];try{const i=r+":"+Composite.ATTRIBUTE_ITERATE;e.innerHTML="";let a=Expression.eval(i,n.iterate.expression);if(a){if(a instanceof XPathResult){const e={entry:null,array:[],iterate:a};for(;e.entry=e.iterate.iterateNext();)e.array.push(e.entry);a=e.array}else a=Array.from(a);a.forEach((o,r,i)=>{const a={};Object.defineProperty(a,"item",{value:o,enumerable:!0}),Object.defineProperty(a,"index",{value:r,enumerable:!0}),Object.defineProperty(a,"data",{value:i,enumerable:!0}),window[n.iterate.name]=a;const c=document.createElement("div");s(e.parentNode).appendChild(c),c.appendChild(n.template.cloneNode(!0).childNodes),Composite.render(c,t.share()),e.appendChild(c.childNodes),delete Composite.render.meta[c.ordinal()]})}}finally{delete window[n.iterate.name],void 0!==o&&(window[n.iterate.name]=o)}}}if(!e.nodeName.match(Composite.PATTERN_ELEMENT_IGNORE)){const t=[];for(const e in n.attributes)n.attributes.hasOwnProperty(e)&&t.push(e);Composite.ATTRIBUTE_VALUE in e&&n.attributes.hasOwnProperty(Composite.ATTRIBUTE_VALUE)&&!t.includes(Composite.ATTRIBUTE_VALUE)&&t.push(Composite.ATTRIBUTE_VALUE),t.forEach(t=>{if(t.match(Composite.PATTERN_ATTRIBUTE_ACCEPT)&&!t.match(Composite.PATTERN_ATTRIBUTE_STATIC))return;let o=String(n.attributes[t]||"");if(!o.match(Composite.PATTERN_EXPRESSION_CONTAINS))return;const s=r+":"+t;void 0!==(o=Expression.eval(s,o))?(o=(o=String(o).encodeHtml()).replace(/"/g,"&quot;"),t.toLowerCase()===Composite.ATTRIBUTE_VALUE&&Composite.ATTRIBUTE_VALUE in e&&(e.value=o),e.setAttribute(t,o)):e.removeAttribute(t)})}if(e.nodeName.match(Composite.PATTERN_SCRIPT)){if((e.getAttribute(Composite.ATTRIBUTE_TYPE)||"").trim().match(Composite.PATTERN_COMPOSITE_SCRIPT))try{Composite.render.include.eval(e.textContent)}catch(e){console.error("Composite JavaScript",e)}}!e.childNodes||e.nodeName.match(Composite.PATTERN_ELEMENT_IGNORE)||n.attributes.hasOwnProperty(Composite.ATTRIBUTE_ITERATE)||Array.from(e.childNodes).forEach(o=>{e.contains(o)&&Composite.render(o,t.share())}),e.hasAttribute(Composite.ATTRIBUTE_RELEASE)&&e.removeAttribute(Composite.ATTRIBUTE_RELEASE)}finally{t.release()}}},Composite.render.include=function(e){if(!("string"==typeof e||e instanceof Element))throw new TypeError("Invalid composite: "+typeof e);let t;if(e instanceof Element){if(!e.hasAttribute(Composite.ATTRIBUTE_ID))throw new Error("Unknown composite without id");if(!(t=Composite.render.meta[e.ordinal()]))throw new Error("Unknown composite")}Composite.render.cache=Composite.render.cache||{};let o=e instanceof Element?e.id:e;t&&t.attributes.hasOwnProperty(Composite.ATTRIBUTE_STRICT)||(o=o.uncapitalize());const r=Composite.MODULES+"/"+o;if(void 0!==Composite.render.cache[r+".composite"])return void(void 0!==Composite.render.cache[r+".html"]&&(!t||t.attributes.hasOwnProperty(Composite.ATTRIBUTE_IMPORT)||t.attributes.hasOwnProperty(Composite.ATTRIBUTE_OUTPUT)||e.innerHTML.trim()||e instanceof Element&&(e.innerHTML=Composite.render.cache[r+".html"])));Composite.render.cache[r+".composite"]=null;const n=t=>{const o=new XMLHttpRequest;if(o.overrideMimeType("text/plain"),o.open("HEAD",t,!1),o.send(),404===o.status)return;if(200!==o.status)throw new Error("HTTP status "+o.status+" for "+o.responseURL);if(o.open("GET",t,!1),o.send(),404===o.status)return;if(200!==o.status)throw new Error("HTTP status "+o.status+" for "+o.responseURL);const r=o.responseText.trim();if(!r)return;const n=document.createElement("a");if(n.href=o.responseURL,Composite.render.cache[n.pathname]=r,o.responseURL.match(/\.css$/)){const e=document.querySelector("html head");if(!e)throw new Error("No head element found");const t=document.createElement("style");t.setAttribute("type","text/css"),t.textContent=r,e.appendChild(t)}else if(o.responseURL.match(/\.js$/))try{Composite.render.include.eval(r)}catch(e){throw console.error(o.responseURL,e.name+": "+e.message),e}else o.responseURL.match(/\.html$/)&&e instanceof Element&&(e.innerHTML=r)};n(r+".css"),n(r+".js"),!t||t.attributes.hasOwnProperty(Composite.ATTRIBUTE_IMPORT)||t.attributes.hasOwnProperty(Composite.ATTRIBUTE_OUTPUT)||e.innerHTML.trim()||n(r+".html")},Composite.render.include.eval=function(script){for(script=script.split(/[\r\n]+/);script&&script.length>0&&script[0].match(/(^\s*(#import(\s+.*)*)*$)/);){const e=script.shift().replace(/^\s*#import(\s+|$)/,"");e.split(/\s+/).forEach(e=>{e&&Composite.render.include(e)})}script=script.join("\r\n").trim(),script&&eval(script)},window.addEventListener("error",e=>{Composite.fire(Composite.EVENT_ERROR,e)}),window.addEventListener("load",()=>{if(document.querySelector("html")){document.querySelector("html head")||document.querySelector("html").appendChild(document.createElement("head"));const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML="*[release] {display:none!important;}",document.querySelector("html head").appendChild(e)}Composite.render.include("common"),new MutationObserver(e=>{e.forEach(e=>{if(!Composite.render.meta)return;const t=e.target.ordinal(),o=Composite.render.meta[t];if("characterData"!==e.type||e.target.nodeType!==Node.TEXT_NODE){if(o&&"attributes"===e.type){const t=(e.attributeName||"").toLowerCase().trim();t.match(Composite.PATTERN_ATTRIBUTE_ACCEPT)&&!t.match(Composite.PATTERN_ATTRIBUTE_STATIC)?e.target.hasAttribute(t)&&e.target.removeAttribute(t):t.match(Composite.PATTERN_ATTRIBUTE_STATIC)?o.attributes.hasOwnProperty(t)?e.target.hasAttribute(t)&&o.attributes[t]===e.target.getAttribute(t)||e.target.setAttribute(t,o.attributes[t]):e.target.hasAttribute(t)&&e.target.removeAttribute(t):Composite.statics.has(t)&&(o.statics=o.statics||{},o.statics.hasOwnProperty(t)?e.target.hasAttribute(t)&&o.statics[t]===e.target.getAttribute(t)||e.target.setAttribute(t,o.statics[t]):e.target.hasAttribute(t)&&e.target.removeAttribute(t))}e.addedNodes&&e.addedNodes.forEach(e=>{(e instanceof Element||e instanceof Node&&e.nodeType===Node.TEXT_NODE)&&!Composite.render.meta[e.ordinal()]&&document.body.contains(e)&&Composite.render(e)}),e.removedNodes&&e.removedNodes.forEach(e=>{const t=e=>{e.childNodes&&Array.from(e.childNodes).forEach(e=>{t(e)});const o=e.ordinal(),r=Composite.render.meta[o];if(r&&r.attributes.hasOwnProperty(Composite.ATTRIBUTE_COMPOSITE)){const t=Composite.mount.lookup(e);t&&t.meta&&t.meta.model&&t.model&&Composite.models.has(t.meta.model)&&(Composite.models.delete(t.meta.model),"function"==typeof t.model.undock&&t.model.undock.call(t.model))}delete Composite.render.meta[e.ordinal()]};t(e)})}else o&&o.hasOwnProperty(Composite.ATTRIBUTE_VALUE)&&String(o.value||"")!==e.target.textContent&&(e.target.textContent=o.value||"")})}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,characterData:!0})})),"undefined"==typeof Expression&&(window.Expression={get TYPE_TEXT(){return 1},get TYPE_EXPRESSION(){return 2},get TYPE_LITERAL(){return 3},get TYPE_SCRIPT(){return 4},get TYPE_KEYWORD(){return 5},get TYPE_OTHER(){return 6},get TYPE_METHOD(){return 7},get TYPE_VALUE(){return 8},get TYPE_LOGIC(){return 9}},Object.defineProperty(Expression,"cache",{value:new Map}),Expression.lookup=function(context,expression){try{if("string"==typeof context&&void 0===expression)return context.match(/^#[a-zA-Z]\w*$/)?document.querySelector(context):context.match(/^(#[a-zA-Z]\w*)\.(.*)*$/)?(expression=context.match(/^(#[a-zA-Z]\w*)\.(.*)*$/),Expression.lookup(document.querySelector(expression[1]),expression[2])):context.indexOf(".")<0?eval(context):(expression=context.match(/^(.*?)\.(.*)$/),Expression.lookup(eval(expression[1]),expression[2]));expression=expression.indexOf(".")<0?[null,expression]:expression.match(/^(.*?)\.(.*)$/);let method="get"+expression[1].capitalize();return"function"!=typeof context[method]&&(method="is"+expression[1].capitalize()),"function"==typeof context[method]?(context=context[method](),expression.length>2?Expression.lookup(context,expression[2]):context):(context=context[expression[1]],expression.length>2?Expression.lookup(context,expression[2]):context)}catch(e){return}},Expression.parse=function(e){if(""===(e=null==e?"":e.trim()))return"";const t={words:[],text:[],expression:[],literal:[],script:[],keyword:[],other:[],value:[],method:[],logic:[]};if((e=(e=(e=(e=e.replace(/(^[\r\n]+)|([\r\n]+$)/g,"")).replace(/[\r\n]/g," ")).replace(/(\{\{)/g,"\n$1")).replace(/(\}\})/g,"$1\n")).indexOf("\n")<0)return'"'+e+'"';e=e.replace(/(^\n+)|(\n+$)/g,"");const o=e=>{e.type===Expression.TYPE_TEXT?t.text.push(e):e.type===Expression.TYPE_EXPRESSION?t.expression.push(e):e.type===Expression.TYPE_SCRIPT?t.script.push(e):e.type===Expression.TYPE_LITERAL?t.literal.push(e):e.type===Expression.TYPE_KEYWORD?t.keyword.push(e):e.type===Expression.TYPE_OTHER?t.other.push(e):e.type===Expression.TYPE_VALUE?t.value.push(e):e.type===Expression.TYPE_METHOD?t.method.push(e):e.type===Expression.TYPE_LOGIC&&t.logic.push(e)};e.split(/\n/).forEach(e=>{const r={type:Expression.TYPE_TEXT,data:e};e.match(/^\{\{.*\}\}$/)?(r.data=r.data.substring(2,r.data.length-2),r.type=Expression.TYPE_EXPRESSION):r.data='"'+r.data.replace(/\\/,"\\\\").replace(/"/,'\\"')+'"',o(r),t.words.push(r)}),t.expression.forEach(e=>{let t=e.data;t=(t=t.replace(/(^|[^\\])((?:\\{2})*)(\\[\'])/g,"$1$2\\u0027")).replace(/(^|[^\\])((?:\\{2})*)(\\[\"])/g,"$1$2\\u0022");const r=[],n=/(^.*?)(([\'\"]).*?(\3|$))/m;for(;t.match(n);)t=t.replace(n,(e,t,n)=>(t={type:Expression.TYPE_SCRIPT,data:t},o(t),r.push(t),n={type:Expression.TYPE_LITERAL,data:n},o(n),r.push(n),""));t.length>0&&(t={type:Expression.TYPE_SCRIPT,data:t},o(t),r.push(t)),e.data=r});const r=["and","&&","or","||","not","!","eq","==","eeq","===","ne","!=","nee","!==","lt","<","gt",">","le","<=","ge",">=","empty","!","div","/","mod","%"];t.script.forEach(e=>{let t=e.data;for(let e=0;e<r.length;e+=2){const o=new RegExp("(^|[^\\w\\.])("+r[e]+")(?=[^\\w\\.]|$)","ig");t=t.replace(o,"$1\n\r"+r[e+1]+"\n")}t=t.replace(/(^|[^\w\.])(true|false|null|instanceof|typeof|undefined|new)(?=[^\w\.]|$)/gi,(e,t,o)=>t+"\n\r"+o.toLowerCase()+"\n");const n=[];t.split(/\n/).forEach(e=>{const t={type:Expression.TYPE_OTHER,data:e};e.match(/^\r/)&&(t.data=e.substring(1),t.type=Expression.TYPE_KEYWORD),o(t),n.push(t)}),e.data=n}),t.other.forEach(e=>{let t=e.data;t=(t=t.replace(/(^|[^\w\.])(#?[a-zA-Z](?:[\w\.]{0,}[\w])?(?=(?:[^\w\(\.]|$)))/g,"$1\n\r\r$2\n")).replace(/(^|[^\w\.])(#?[a-zA-Z](?:[\w\.]{0,}\w)?)(?=\()/g,"$1\n\r$2\n");const r=[];t.split(/\n/).forEach(e=>{const t={type:Expression.TYPE_LOGIC,data:e};e.match(/^\r\r/)?(t.data='Expression.lookup("'+e.substring(2)+'")',t.type=Expression.TYPE_VALUE):e.match(/^\r[^\r]/)&&(t.data=e.substring(1),t.data.match(/^#[a-zA-Z]/)&&(t.data='Expression.lookup("'+t.data+'")'),t.type=Expression.TYPE_METHOD),o(t),r.push(t)}),e.data=r});const n=[],s=e=>{Array.isArray(e)?e.forEach(e=>{s(e)}):Array.isArray(e.data)?e.data.forEach(e=>{s(e)}):"string"==typeof e.data&&(e.data&&e.data.length?n.push(e):s(e.data))};s(t.words);let i="";return n.forEach(e=>{e.type===Expression.TYPE_TEXT?i+="\n"+e.data+"\r":e.type===Expression.TYPE_KEYWORD?i+=" "+e.data+" ":e.type!==Expression.TYPE_LITERAL&&e.type!==Expression.TYPE_VALUE&&e.type!==Expression.TYPE_METHOD&&e.type!==Expression.TYPE_LOGIC||(i+=e.data)}),(i=i.replace(/(^\n)|(\r$)/g,"")).match(/\r[^\n]*$/)&&(i+=")"),i.match(/^[^\r]*\n/)&&(i="("+i),i=(i=(i=(i=i.replace(/(\n\r)+/g," + ")).replace(/\r/g," + (")).replace(/\n/g,") + ")).replace(/(^\s*\+\s*)|(\s*\+\s*$)/,"")},Expression.eval=function(...variants){let expression,serial;variants.length>1?expression=String(variants[1]):variants.length>0&&(expression=String(variants[0])),variants.length>1&&variants[0]&&(serial=String(variants[0]));let script=serial?Expression.cache.get(serial):null;script||(script=Expression.parse(expression)),serial&&Expression.cache.set(serial,script);try{return eval(script)}catch(e){return e.message+="\n\t"+script,console.error(e),e.message}}),"undefined"==typeof Path&&(window.Path={get PATTERN_PATH(){return/(?:^(?:\w(?:\-*\w)*)*(?:(?:#+\w(?:\-*\w)*)+)#*$)|(?:^\w(?:\-*\w)*$)|(?:^#+$)|(?:^$)/},get PATTERN_URL(){return/^\w+:\/.*?(#.*)*$/i},get PATTERN_PATH_FUNCTIONAL(){return/^#{3,}$/}},Path.normalize=function(...e){if(e.length<=0)return null;if(e.length>0&&!Object.usable(e[0]))return null;if(e.length>1&&!Object.usable(e[1]))return null;if(e.length>1&&"string"!=typeof e[0])throw new TypeError("Invalid root: "+typeof e[0]);let t="#";if(e.length>1){t=e[0];try{t=Path.normalize(t)}catch(e){throw t=(t||"").trim(),new TypeError("Invalid root"+(t?": "+t:""))}}if(e.length>1&&"string"!=typeof e[1])throw new TypeError("Invalid path: "+typeof e[1]);if(e.length>0&&"string"!=typeof e[0])throw new TypeError("Invalid path: "+typeof e[0]);let o="";if(1===e.length&&(o=e[0]),1===e.length&&o.match(Path.PATTERN_URL)?o=o.replace(Path.PATTERN_URL,"$1"):e.length>1&&(o=e[1]),!(o=(o||"").trim()).match(Path.PATTERN_PATH))throw new TypeError("Invalid path"+(String(o).trim()?": "+o:""));if((o=(o=o.replace(/([^#])#$/,"$1")).replace(/^([^#])/,"#$1")).match(Path.PATTERN_PATH_FUNCTIONAL))return"###";o=(o=t+o).toLowerCase();const r=/#[^#]+#{2}/;for(;o.match(r);)o=o.replace(r,"#");return o="#"+o.replace(/(^#+)|(#+)$/g,"")}),"undefined"==typeof SiteMap&&(window.SiteMap={get PATTERN_PATH_FACE(){return/(^((#\w[\-\w]+\w)|(#\w+))+$)|(^#$)/},get PATTERN_PATH_FACET(){return/^((\w[\-\w]+\w)|(\w+))(#((\w[\-\w]+\w)|(\w+)))*$/},get PATTERN_PATH_FACET_VARIABLE(){return/(^((\w[\-\w]+\w)|(\w+))(#((\w[\-\w]+\w)|(\w+)))*(\.){3}$)|(^\.{3}$)/},get location(){if(SiteMap.history.size<=0)return window.location.hash||"#";const e=Array.from(SiteMap.history);return e[e.length-1]},set location(e){if(SiteMap.history.has(e)){const t=Array.from(SiteMap.history.values());for(;SiteMap.history.has(e)&&t.includes(e);){const o=t.pop();if(o===e)return;SiteMap.history.delete(o)}}else SiteMap.history.add(e)}},Object.defineProperty(SiteMap,"paths",{value:new Map}),Object.defineProperty(SiteMap,"facets",{value:new Map}),Object.defineProperty(SiteMap,"variables",{value:new Set}),Object.defineProperty(SiteMap,"acceptors",{value:new Set}),Object.defineProperty(SiteMap,"history",{value:new Set}),SiteMap.permit=function(e){for(let t of SiteMap.acceptors)if((!t.pattern||t.pattern.test(e))&&!0!==(t=t.action.call(null,e)))return"string"==typeof t&&(t=Path.normalize(t)),t;return!0},SiteMap.locate=function(e){e=e||"";const t=e=>{const t=[SiteMap.location,e];return e.match(/(^#[^#].*$)|(^#$)/)&&t.shift(),t};try{e=Path.normalize(...t(e))}catch(o){for(;;){e=e.replace(/(^[^#]+$)|(#[^#]*$)/,"");try{e=Path.normalize(...t(e))}catch(e){continue}break}}if(e.match(Path.PATTERN_PATH_FUNCTIONAL))return e;let o=Array.from(SiteMap.paths.keys());for(o=o.concat(Array.from(SiteMap.facets.keys()));o&&e.length>1;){for(const t of SiteMap.variables)if((e+"#").startsWith(t+"#"))return e;if(o.includes(e))return e;e=Path.normalize(e+"##")}return"#"},SiteMap.navigate=function(e){Composite.asynchron(e=>{window.location.hash=e},SiteMap.locate(e)),SiteMap.locate(e)},SiteMap.forward=function(e){const t=document.createEvent("HTMLEvents");t.initEvent("hashchange",!1,!0),t.newURL=e,window.dispatchEvent(t)},SiteMap.lookup=function(e){arguments.length<=0&&(e=SiteMap.location);const t=e=>e.facet?e.path.endsWith("#")?e.path+e.facet:e.path+"#"+e.facet:e.path;for(const t of SiteMap.variables)if((e+"#").startsWith(t+"#")){if(SiteMap.paths.has(t))return{path:e,face:t,facet:null,get data(){return e.substring(t.length)||null}};if(SiteMap.facets.has(t)){const o=SiteMap.facets.get(t);return{path:e,face:o.path,facet:o.facet,get data(){return e.substring(o.path.length+o.facet.length)||null}}}break}if(SiteMap.paths.has(e))return{path:e,face:e,facet:null};if(SiteMap.facets.has(e)){const o=SiteMap.facets.get(e);return{path:t(o),face:o.path,facet:o.facet}}return null},SiteMap.accept=function(e){if(!(e=(e||"").trim().toLowerCase()).match(/^#.*$/))return!1;e=e.replace(/(#.*?)#*$/,"$1");const t=SiteMap.lookup(Path.normalize(SiteMap.location));if(!t)return!1;const o=SiteMap.lookup(e);if(!o)return!1;let r=o.path;return r.endsWith("#")||(r+="#"),!(o.facet&&t.face!==o.face&&!t.path.startsWith(r))&&!(!t.path.startsWith(r)&&t.face!==o.face)},SiteMap.customize=function(...e){if(e.length>1&&e[0]instanceof RegExp){if("function"!=typeof e[1])throw new TypeError("Invalid acceptor: "+typeof e[1]);return void SiteMap.acceptors.add({pattern:e[0],action:e[1]})}if(e.length<1||"object"!=typeof e[0])throw new TypeError("Invalid map: "+typeof e[0]);const t=e[0],o=new Set(SiteMap.acceptors);if(e.length>1){if("function"!=typeof e[1])throw new TypeError("Invalid permit: "+typeof e[1]);o.add({pattern:null,action:e[1]})}const r=new Map;SiteMap.paths.forEach((e,t)=>{"string"==typeof t&&t.match(SiteMap.PATTERN_PATH_FACE)&&r.set(t,e)});const n=new Map;SiteMap.facets.forEach((e,t)=>{"string"==typeof t&&t.match(SiteMap.PATTERN_PATH_FACET)&&n.set(t,e)});let s=new Set;SiteMap.variables.forEach(e=>{"string"==typeof e&&e.match(SiteMap.PATTERN_PATH_FACE)&&s.add(e)}),Object.keys(t).forEach(e=>{if("string"!=typeof e||!e.match(SiteMap.PATTERN_PATH_FACE))return;let o=t[e];(null===o||Array.isArray(o))&&(e=Path.normalize(e),r.has(e)||r.set(e,[]),(o=o||[]).forEach(t=>{if("string"!=typeof t)throw new TypeError("Invalid facet: "+typeof t);if(!(t=t.toLowerCase().trim()).match(SiteMap.PATTERN_PATH_FACET)&&!t.match(SiteMap.PATTERN_PATH_FACET_VARIABLE))throw new Error("Invalid facet"+(t?": "+t:""));if(t.match(SiteMap.PATTERN_PATH_FACET_VARIABLE)){const o=(t=t.replace(/\.+$/,""))?e.replace(/#+$/,"")+"#"+t:e;if(s.has(o)||s.add(o),!t)return}r.get(e).includes(t)||r.get(e).push(t),n.set(Path.normalize(e,t),{path:e,facet:t})}))}),SiteMap.acceptors.clear(),o.forEach(e=>{SiteMap.acceptors.add(e)}),SiteMap.paths.clear(),r.forEach((e,t)=>{SiteMap.paths.set(t,e)}),SiteMap.facets.clear(),n.forEach((e,t)=>{SiteMap.facets.set(t,e)}),SiteMap.variables.clear(),(s=Array.from(s)).sort((e,t)=>e.localeCompare(t)),s.forEach(e=>{SiteMap.variables.add(e)})},Composite.customize(e=>{if(!(e instanceof Element&&e.hasAttribute(Composite.ATTRIBUTE_COMPOSITE)))return;if(e.hasAttribute("static"))return;let t="";for(let o=e;o;o=o.parentNode){if(!(o instanceof Element&&o.hasAttribute(Composite.ATTRIBUTE_COMPOSITE)))continue;const e=(o.getAttribute(Composite.ATTRIBUTE_ID)||"").trim();if(!e.match(Composite.PATTERN_COMPOSITE_ID))throw new Error("Invalid composite id"+(e?": "+e:""));t="#"+e+t}let o=null;e.hasAttribute(Composite.ATTRIBUTE_CONDITION)&&(o=e.getAttribute(Composite.ATTRIBUTE_CONDITION).trim()).match(Composite.PATTERN_EXPRESSION_CONTAINS)&&(o=o.replace(Composite.PATTERN_EXPRESSION_CONTAINS,e=>(e=e.substring(2,e.length-2).trim(),'{{SiteMap.accept("'+t+'") and ('+e+")}}"))),o||(o=(o||"")+'{{SiteMap.accept("'+t+'")}}'),e.setAttribute(Composite.ATTRIBUTE_CONDITION,o)}),Composite.customize("@ATTRIBUTES-STATICS","static"),window.addEventListener("load",()=>{document.body.addEventListener("click",e=>{if(e.target&&e.target instanceof Element&&e.target.hasAttribute("href")){const t=SiteMap.lookup(e.target.getAttribute("href")),o=SiteMap.lookup(Path.normalize(SiteMap.location));o&&t&&o.face===t.face&&o.facet===t.facet&&"function"==typeof t.focus&&t.focus()}}),SiteMap.forward(window.location.hash||"#")}),window.addEventListener("hashchange",e=>{const t=SiteMap.history.size<=0;if(SiteMap.paths.size<=0)return void(t&&Composite.render(document.body));let o=Path.normalize(SiteMap.location),r=(e.newURL||"").replace(Path.PATTERN_URL,"$1"),n=SiteMap.locate(r);if(n.match(Path.PATTERN_PATH_FUNCTIONAL)&&t&&(n="#"),n.match(Path.PATTERN_PATH_FUNCTIONAL))return void history.replaceState(null,document.title,SiteMap.location);if(n===window.location.hash&&n===SiteMap.location&&!t)return;const s=SiteMap.permit(n);if(!0!==s)return void("string"==typeof s?SiteMap.forward(s):SiteMap.forward("#"!==n?n+"##":"#"));SiteMap.location=n,o=SiteMap.lookup(o),n=SiteMap.lookup(n),(o=o.face).endsWith("#")||(o+="#"),(n=n.face).endsWith("#")||(n+="#");let i="#";o.startsWith(n)?i=n:n.startsWith(o)&&(i=o),(i=i.match(/((?:#[^#]+)|(?:^))#*$/))&&i[1]&&!t?Composite.render(i[1]):Composite.render(document.body),window.location.assign(SiteMap.location),window.location.hash=window.location.hash})),"undefined"==typeof Test&&(window.Test={get PATTERN_EVENT(){return/^[a-z]+$/},get EVENT_FINISH(){return"finish"},get EVENT_INTERRUPT(){return"interrupt"},get EVENT_PERFORM(){return"perform"},get EVENT_RESPONSE(){return"response"},get EVENT_RESUME(){return"resume"},get EVENT_START(){return"start"},get EVENT_SUSPEND(){return"suspend"}},Test.activate=function(){void 0===Test.activate.lock&&(Object.defineProperty(Test.activate,"lock",{value:!0}),Object.defineProperty(Test,"stack",{value:new Set}),Object.defineProperty(Test,"listeners",{value:new Map}),Test.listen=function(e,t){if("string"!=typeof e)throw new TypeError("Invalid event: "+typeof e);if("function"!=typeof t&&null!=t)throw new TypeError("Invalid callback: "+typeof t);if(!e.match(Test.PATTERN_EVENT))throw new Error("Invalid event"+(e.trim()?": "+e:""));e=e.toLowerCase(),Test.listeners.has(e)||Array.isArray(Test.listeners.get(e))||Test.listeners.set(e,[]),Test.listeners.get(e).push(t)},Test.fire=function(e,t){"object"==typeof Test.worker&&(Test.worker.status=e);const o=(e,t,o)=>{if("object"==typeof e.Test.worker&&"object"==typeof e.Test.worker.monitor&&"function"==typeof e.Test.worker.monitor[t])try{e.Test.worker.monitor[t](o)}catch(e){console.error(e)}if(t=(t||"").trim(),e.Test.listeners.size<=0||!t)return;const r=e.Test.listeners.get(t.toLowerCase());Array.isArray(r)&&r.forEach(e=>{e(t,o)})};if(o(window,e,t),parent&&parent!==window)try{o(parent,e,t)}catch(e){}},Test.create=function(e){if("object"!=typeof e||"function"!=typeof e.test)return;if(void 0!==e.ignore&&!0===e.ignore)return;if(Test.stack.has(e))return;Test.stack.add(e);const t=Array.from(Test.stack);Object.defineProperty(e,"serial",{value:Math.max(t.length,t.length>1?t[t.length-2].serial+1:1)})},Test.start=function(e){if(void 0!==Test.worker)return;if(e&&e.auto&&("loading"===document.readyState||"interactive"===document.readyState))return void(void 0===Test.start.auto&&(Object.defineProperty(Test.start,"auto",{value:!0}),window.addEventListener("load",()=>{Test.start(e)})));const t=(e,t)=>e+" "+t+(1!==e?"s":"");Test.worker={},Test.worker.output=e?e.output:null,Test.worker.output=Test.worker.output||console,Test.worker.monitor=e?e.monitor:null,Test.worker.monitor=Test.worker.monitor||{start(e){Test.worker.output.log((new Date).toUTCString()+" Test is started, "+t(e.queue.size,"task")+" in the queue")},suspend(e){Test.worker.output.log((new Date).toUTCString()+" Test is suspended, "+t(e.queue.length,"task")+" still outstanding")},resume(e){Test.worker.output.log((new Date).toUTCString()+" Test is continued , "+t(e.queue.size,"task")+" in the queue")},interrupt(e){Test.worker.output.log((new Date).toUTCString()+" Test is interrupted\n\t"+t(e.queue.size-e.queue.progress,"task")+" still outstanding\n\t"+t(e.queue.faults,"fault")+" were detected\n\ttotal time "+((new Date).getTime()-e.queue.timing)+" ms")},perform(e){},response(e){const t=(new Date).getTime()-e.task.timing;e.task.error?Test.worker.output.error((new Date).toUTCString()+" Test task "+e.task.title+" "+e.task.error.message):Test.worker.output.log((new Date).toUTCString()+" Test task "+e.task.title+" was successful ("+t+" ms)")},finish(e){Test.worker.output.log((new Date).toUTCString()+" Test is finished\n\t"+t(e.queue.size,"task")+" were performed\n\t"+t(e.queue.faults,"fault")+" were detected\n\ttotal time "+((new Date).getTime()-e.queue.timing)+" ms")}},Test.worker.queue=Test.worker.queue||{timing:!1,stack:[],size:0,lock:!1,progress:0,faults:0},Test.worker.queue.stack.length<=0&&(Test.worker.queue.stack=Array.from(Test.stack),Test.worker.queue.size=Test.worker.queue.stack.length,Test.worker.queue.timing=(new Date).getTime()),Test.worker.timeout=window.setInterval(()=>{if(Test.worker.status===Test.EVENT_SUSPEND)return;if(void 0===Test.worker.task||!Test.worker.task.running||!Test.worker.queue.lock)return;const e=Test.worker.task;!e.timeout||e.timeout>(new Date).getTime()||(e.duration=(new Date).getTime()-e.timing,e.error=new Error("Timeout occurred, expected "+e.timeout+" ms but was "+e.duration+" ms"),Test.fire(Test.EVENT_RESPONSE,Test.status()),Test.worker.queue.faults++,Test.worker.queue.lock=!1)},25),Test.worker.interval=window.setInterval(()=>{if(Test.worker.status!==Test.EVENT_SUSPEND&&(!Test.worker.queue.lock&&Test.worker.queue.progress<=0&&Test.fire(Test.EVENT_START,Test.status()),!Test.worker.queue.lock)){if(Test.worker.queue.stack.length>0){Test.worker.queue.lock=!0,Test.worker.queue.progress++;const e=Test.worker.queue.stack.shift();let t=!1;return(e.timeout||0)>0&&(t=(new Date).getTime()+e.timeout),Test.worker.task={title:null,meta:e,running:!0,timing:(new Date).getTime(),timeout:t,duration:!1,error:null},Test.worker.task.title="#"+e.serial,"string"==typeof e.name&&e.name.trim().length>0&&(Test.worker.task.title+=" "+e.name.replace(/[\x00-\x20]+/g," ").trim()),Test.fire(Test.EVENT_PERFORM,Test.status()),void Composite.asynchron(()=>{const e=Test.worker.task;try{e.meta.test()}catch(t){e.error=t,e.error.message&&e.error.message.trim()||(e.error.message="failed")}finally{e.meta.expected&&(e.error?("function"==typeof e.meta.expected&&e.error instanceof e.meta.expected&&(e.error=null),"object"==typeof e.meta.expected&&e.meta.expected instanceof RegExp&&String(e.error).match(e.meta.expected)&&(e.error=null)):e.error=Error("Assert error expected failed")),e.running=!1,e.duration=(new Date).getTime()-e.timing,e.timeout&&e.timeout<(new Date).getTime()&&!e.error&&(e.error=new Error("Timeout occurred, expected "+e.meta.timeout+" ms but was "+e.duration+" ms"),Test.fire(Test.EVENT_RESPONSE,Test.status()),Test.worker.queue.faults++),e.error&&String(e.error.message).match(/^Timeout occurred/)||(e.error&&Test.worker.queue.faults++,Test.fire(Test.EVENT_RESPONSE,Test.status())),Test.worker.queue.lock=!1}})}window.clearTimeout(Test.worker.interval),window.clearTimeout(Test.worker.timeout),Test.fire(Test.EVENT_FINISH,Test.status()),delete Test.worker}},25)},Test.suspend=function(){if(void 0===Test.worker)throw new Error("Suspend is not available");Test.fire(Test.EVENT_SUSPEND,Test.status())},Test.resume=function(){if(void 0===Test.worker||Test.worker.status!==Test.EVENT_SUSPEND)throw new Error("Resume is not available");Test.fire(Test.EVENT_RESUME,Test.status())},Test.interrupt=function(){if(void 0===Test.worker)throw new Error("Interrupt is not available");window.clearTimeout(Test.worker.interval),window.clearTimeout(Test.worker.timeout),Test.fire(Test.EVENT_INTERRUPT,Test.status()),delete Test.worker},Test.status=function(){const e={};return"object"==typeof Test.worker&&"object"==typeof Test.worker.task&&(e.task={},Object.defineProperty(e.task,"title",{value:Test.worker.task.title,enumerable:!0}),Object.defineProperty(e.task,"meta",{value:Test.worker.task.meta,enumerable:!0}),Object.defineProperty(e.task,"running",{value:Test.worker.task.running,enumerable:!0}),Object.defineProperty(e.task,"timing",{value:Test.worker.task.timing,enumerable:!0}),Object.defineProperty(e.task,"timeout",{value:Test.worker.task.timeout,enumerable:!0}),Object.defineProperty(e.task,"duration",{value:Test.worker.task.duration,enumerable:!0}),Object.defineProperty(e.task,"error",{value:Test.worker.task.error,enumerable:!0})),"object"==typeof Test.worker&&"object"==typeof Test.worker.queue&&(e.queue={},Object.defineProperty(e.queue,"timing",{value:Test.worker.queue.timing,enumerable:!0}),Object.defineProperty(e.queue,"size",{value:Test.worker.queue.size,enumerable:!0}),Object.defineProperty(e.queue,"length",{value:Test.worker.queue.stack.length,enumerable:!0}),Object.defineProperty(e.queue,"progress",{value:Test.worker.queue.progress,enumerable:!0}),Object.defineProperty(e.queue,"lock",{value:Test.worker.queue.lock,enumerable:!0}),Object.defineProperty(e.queue,"faults",{value:Test.worker.queue.faults,enumerable:!0})),(void 0!==e.task||void 0!==e.queue)&&e},"undefined"==typeof Assert&&(window.Assert={},Assert.create=function(arguments,e){const t={message:null,values:[],error(){const e=Array.from(arguments);e.forEach((e,o,r)=>{r[o]=String(e).replace(/\{(\d+)\}/g,(e,o)=>o>t.values.length?"[null]":String(t.values[o]).replace(/\s*[\r\n]+\s*/g," "))});let o="expected {1} but was {2}";return null!==t.message&&(t.message=t.message.trim(),t.message&&(o=t.message)),o=(o="{0} failed, "+o).replace(/\{(\d+)\}/g,(t,o)=>o>e.length?"[null]":String(e[o]).replace(/\s*[\r\n]+\s*/g," ")),new Error(o)}};for((arguments=Array.from(arguments)).length>e&&(t.message=arguments.shift());arguments.length>0;)t.values.push(arguments.shift());return t},Assert.assertTrue=function(...e){const t=Assert.create(e,1);if(!0!==t.values[0])throw t.error("Assert.assertTrue","true","{0}")},Assert.assertFalse=function(...e){const t=Assert.create(e,1);if(!1!==t.values[0])throw t.error("Assert.assertFalse","false","{0}")},Assert.assertEquals=function(...e){const t=Assert.create(e,2);if(t.values[0]!==t.values[1])throw t.error("Assert.assertEquals","{0}","{1}")},Assert.assertNotEquals=function(...e){const t=Assert.create(e,2);if(t.values[0]===t.values[1])throw t.error("Assert.assertNotEquals","not {0}","{1}")},Assert.assertSame=function(...e){const t=Assert.create([],e,2);if(t.values[0]!==t.values[1])throw t.error("Assert.assertSame","{0}","{1}")},Assert.assertNotSame=function(...e){const t=Assert.create(e,2);if(t.values[0]===t.values[1])throw t.error("Assert.assertNotSame","not {0}","{1}")},Assert.assertNull=function(...e){const t=Assert.create(e,1);if(null!==t.values[0])throw t.error("Assert.assertNull","null","{0}")},Assert.assertNotNull=function(...e){const t=Assert.create(e,1);if(null===t.values[0])throw t.error("Assert.assertNotNull","not null","{0}")},Assert.fail=function(e){throw e&&(e=String(e).trim()),e="Assert.fail"+(e?", "+e:""),new Error(e)}),console.output={log:"",warn:"",error:"",info:""},console.output.clear=function(){console.output.log="",console.output.warn="",console.output.error="",console.output.info=""},Object.defineProperty(console,"listeners",{value:new Set}),console.listen=function(e){console.listeners.add(e)},console.forward=function(e,t,o){console.output[e]+=Array.from(t).join(", "),o&&o(...t),console.listeners.forEach(o=>{o(e,...t)}),parent&&parent!==window&&parent.console&&"function"==typeof parent.console.forward&&parent.console.forward(...Array.from(arguments).slice(0,2))},console.log$origin=console.log,console.log=function(...e){console.forward("log",e,console.log$origin)},console.warn$origin=console.warn,console.warn=function(...e){console.forward("warn",e,console.warn$origin)},console.error$origin=console.error,console.error=function(...e){console.forward("error",e,console.error$origin)},console.info$origin=console.info,console.info=function(...e){console.forward("info",e,console.info$origin)},window.addEventListener("error",function(e){parent&&parent!==window&&console.forward("error",((...e)=>e)(e.message),null)}),void 0===Element.prototype.typeValue&&(Element.prototype.typeValue=function(e,t){this.focus(),!1!==t&&(this.value="");const o=this;(e=(e||"").split("")).forEach(e=>{o.trigger("keydown"),o.value=(o.value||"")+e,o.trigger("keyup")}),this.trigger("input")}),void 0===Node.prototype.toPlainString&&(Node.prototype.toPlainString=function(){return(new XMLSerializer).serializeToString(this)}),void 0===Element.prototype.toPlainString&&(Element.prototype.toPlainString=function(){return this.outerHTML}),void 0===Object.prototype.toPlainString&&(Object.prototype.toPlainString=function(){return null!==this&&"function"==typeof this[Symbol.iterator]?JSON.stringify([...this]):JSON.stringify(this)}),void 0===Element.prototype.trigger&&(Element.prototype.trigger=function(e,t=!1,o=!0){const r=document.createEvent("Event");r.initEvent(e,t,o),this.dispatchEvent(r)}))});