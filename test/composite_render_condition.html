<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>Seanox aspect-js test environment</title>
    <style type="text/css">
      body {
        font-family:monospace;
        white-space:pre;
      }
      body div {
        margin:1em;
      }
    </style>
    <script src="aspect-js.js"></script>
    <script type="text/javascript">
    
        Test.activate();
    
        var Model = {
            onA: false,
            toggleA: function() {
                this.onA = !this.onA;
                return this.onA;
            },
            onB: false,
            toggleB: function() {
                this.onB = !this.onB;
                return this.onB;
            },
            onC: false,
            toggleC: function() {
                this.onC = !this.onC;
                return this.onC;
            },
            onD: false,
            toggleD: function() {
                this.onD = !this.onD;
                return this.onD;
            },
            onE: false,
            toggleE: function() {
                this.onE = !this.onE;
                return this.onE;
            },
            listE: ["a", "b", "c"]
        };
        
        var testS = function(text) {
            var span = document.createElement("span");
            span.textContent = text;
            return span;
        };        
        
        var snapshots = [];
        Composite.listen(Composite.EVENT_RENDER_END, function() {
            var snapshot = document.body.textContent;
            snapshot = snapshot.replace(/^\s+/mg, "");
            snapshots.push(snapshot);
            if (snapshots.length < 5)
                Composite.asynchron(Composite.render, document.body);
            else if (snapshots.length == 5)
                Test.start();
        });

        var x1 = 0;
        var x2 = 0;
        var x3 = 0;
        var x4 = 0;
        
        Test.create({test:function() {
            Assert.assertSameTo("script[type='text/test-1']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertSameTo("script[type='text/test-2']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertSameTo("script[type='text/test-3']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertSameTo("script[type='text/test-4']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertSameTo("script[type='text/test-5']", snapshots.shift());
        }});
    </script>
    <script type="text/test-1">
A1AA
B1B
C1C
D1D
E1E
OnA: false
A2AA
B2B
C2CC    
OnA: true
O1: 1x1++; output1.textContent = x1;
O2: 1x2++; output2.textContent = x2;
O3: 1 falsex3++; output3.textContent = x3;
O4: 1 falsex4++; output4.textContent = x4;
E::E
S:1:1:S    
OnA: true
OnB: false
A3-1 
A3-2
A3-3
A3-4
OnA: false
OnB: true    
    </script>
    <script type="text/test-2">
A1AA
B1B
C1C
D1D
E1E
OnA: false
A2AA
B2B
C2CC    
OnA: true
O1: 1x1++; output1.textContent = x1;
O2: 2x2++; output2.textContent = x2;
O3: 1 true 
O4: 1 true 
E:abc:E
S:2:2:S    
OnA: true
OnB: true
OnA: true
OnB: false
    </script>
    <script type="text/test-3">
A1AA
B1B
C1C
D1D
E1E
OnA: true
A2A
B2BB
C2C    
OnA: false
O1: 1x1++; output1.textContent = x1;
O2: 3x2++; output2.textContent = x2;
O3: 1 falsex3++; output3.textContent = x3;
O4: 2 falsex4++; output4.textContent = x4;
E::E
S:3:3:S    
OnA: false
OnB: false
A3-1 
A3-2
A3-3
A3-4
A3-5
OnA: true
OnB: true      
    </script>
    <script type="text/test-4">
A1AA
B1B
C1C
D1D
E1E
OnA: true
A2A
B2BB
C2C    
OnA: false
O1: 1x1++; output1.textContent = x1;
O2: 4x2++; output2.textContent = x2;
O3: 1 true 
O4: 2 true 
E:abc:E
S:4:4:S    
OnA: false
OnB: true
OnA: false
OnB: false 
    </script> 
    <script type="text/test-5">
A1AA
B1B
C1C
D1D
E1E
OnA: false
A2AA
B2B
C2CC    
OnA: true
O1: 1x1++; output1.textContent = x1;
O2: 5x2++; output2.textContent = x2;
O3: 1 falsex3++; output3.textContent = x3;
O4: 3 falsex4++; output4.textContent = x4;
E::E
S:5:5:S    
OnA: true
OnB: false
A3-1 
A3-2
A3-3
A3-4
OnA: false
OnB: true
    </script>         
  </head>
  <body>
    A1<span condition="{{true}}">A</span>A
    B1<span condition="{{false}}">B</span>B
    C1<span condition="{{1}}">C</span>C
    D1<span condition="{{0}}">D</span>D
    E1<span condition="{{null}}">E</span>E

    OnA: {{Model.onA}}
    A2<span condition="{{Model.toggleA()}}">A</span>A
    B2<span condition="{{Model.toggleA()}}">B</span>B
    C2<span condition="{{Model.toggleA()}}">C</span>C    
    OnA: {{Model.onA}}
    
    O1: <span id="output1"></span><script type="text/javascript">x1++; output1.textContent = x1;</script>
    O2: <span id="output2"></span><script type="composite/javascript">x2++; output2.textContent = x2;</script>
    O3: <span id="output3"></span> {{Model.onC}}<script type="text/javascript"
        condition="{{Model.toggleC()}}">x3++; output3.textContent = x3;</script>
    O4: <span id="output4"></span> {{Model.onD}}<script type="composite/javascript"
        condition="{{Model.toggleD()}}">x4++; output4.textContent = x4;</script>
        
    E:<span iterate="{{list:Model.listE}}"
        condition="{{not Model.toggleE()}}"><span>{{list.item}}</span></span>:E
    
    {{s1:(s1 || 0) +1}}
    S:{{s1}}:<span id="outputS1" condition="{{true}}" import="{{testS(s1)}}">---</span>:S    

    OnA: {{Model.onA}}
    OnB: {{Model.onB}}
    <span condition="{{Model.toggleB()}}">A3-1 
      <span condition="{{true}}">A3-2
        <span condition="{{true}}">A3-3
          <span condition="{{true}}">A3-4
            <span condition="{{Model.toggleA()}}">A3-5
            </span>
          </span>
        </span>
      </span>
    </span>

    OnA: {{Model.onA}}
    OnB: {{Model.onB}}                  
  </body>
</html>