<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>Seanox aspect-js test environment</title>
    <style type="text/css">
      body {
        font-family:monospace;
        white-space:pre;
      }
      body div {
        margin:1em;
      }
    </style>
    <script src="../sources/extension.js"></script>
    <script src="../sources/composite.js"></script>
    <script src="../sources/test.js"></script>
    <script src="../sources/testutils.js"></script>
    <script type="text/javascript">
    
        var Model = {
              onA: false,
              toggleA: function() {
                  this.onA = !this.onA;
                  return this.onA;
              },
              onB: false,
              toggleB: function() {
                  this.onB = !this.onB;
                  return this.onB;
              },
              onC: false,
              toggleC: function() {
                  this.onC = !this.onC;
                  return this.onC;
              },
              onD: false,
              toggleD: function() {
                  this.onD = !this.onD;
                  return this.onD;
              },
              onE: false,
              toggleE: function() {
                  this.onE = !this.onE;
                  return this.onE;
              },
              listE: ["a", "b", "c"]
        };
        
        var snapshots = new Array();
        Composite.listen(Composite.EVENT_RENDER_END, function() {
            var snapshot = document.body.textContent;
            snapshot = snapshot.replace(/^\s+/mg, "");
            snapshots.push(snapshot);
        });
        
        var count = 0;
        var interval = window.setInterval(function() {
            Composite.render("body");
            if (++count < 4)
                return;
            window.clearInterval(interval);
            Test.start();
        }, 250);
        var x1 = 0;
        var x2 = 0;
        var x3 = 0;
        var x4 = 0;
        
        Test.create({test:function() {
            Assert.assertEqualsTemplate("script[type='text/test-1']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertEqualsTemplate("script[type='text/test-2']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertEqualsTemplate("script[type='text/test-3']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertEqualsTemplate("script[type='text/test-4']", snapshots.shift());
        }});
        Test.create({test:function() {
            Assert.assertEqualsTemplate("script[type='text/test-5']", snapshots.shift());
        }});
    </script>
    <script type="text/test-1">
    A1AA
    B1B
    C1C
    D1D
    E1E
    A2AA
    B2B
    C2CC    
    false
    true
    O1: 1 x1++; output1.textContent = x1;
    O2: 1 x2++; output2.textContent = x2;
    O3: 1 false x3++; output3.textContent = x3;
    O4: 1 false x4++; output4.textContent = x4;
    E::E
    A3-1 
    A3-2
    A3-3
    A3-4
    </script>
    <script type="text/test-2">
    A1AA
    B1B
    C1C
    D1D
    E1E
    A2AA
    B2B
    C2CC    
    false
    true
    O1: 1 x1++; output1.textContent = x1;
    O2: 2 x2++; output2.textContent = x2;
    O3: 1 true
    O4: 1 true
    E:abc:E    
    </script>
    <script type="text/test-3">
    A1AA
    B1B
    C1C
    D1D
    E1E
    A2A
    B2BB
    C2C    
    true
    false
    O1: 1 x1++; output1.textContent = x1;
    O2: 3 x2++; output2.textContent = x2;
    O3: 1 false x3++; output3.textContent = x3;
    O4: 2 false x4++; output4.textContent = x4;
    E::E
    A3-1 
    A3-2
    A3-3
    A3-4
    A3-5    
    </script>
    <script type="text/test-4">
    A1AA
    B1B
    C1C
    D1D
    E1E
    A2A
    B2BB
    C2C    
    true
    false
    O1: 1 x1++; output1.textContent = x1;
    O2: 4 x2++; output2.textContent = x2;
    O3: 1 true
    O4: 2 true
    E:abc:E    
    </script>
    <script type="text/test-5">
    A1AA
    B1B
    C1C
    D1D
    E1E
    A2AA
    B2B
    C2CC    
    false
    true
    O1: 1 x1++; output1.textContent = x1;
    O2: 5 x2++; output2.textContent = x2;
    O3: 1 false x3++; output3.textContent = x3;
    O4: 3 false x4++; output4.textContent = x4;
    E::E
    A3-1 
    A3-2
    A3-3
    A3-4    
    </script>    
  </head>
  <body>
    A1<span condition="{{true}}">A</span>A
    B1<span condition="{{false}}">B</span>B
    C1<span condition="{{1}}">C</span>C
    D1<span condition="{{0}}">D</span>D
    E1<span condition="{{null}}">E</span>E
    
    A2<span condition="{{Model.toggleA()}}">A</span>A
    B2<span condition="{{Model.toggleA()}}">B</span>B
    C2<span condition="{{Model.toggleA()}}">C</span>C    
    
    {{Model.toggleA()}}
    {{Model.toggleA()}}
    
    O1: <span id="output1">
      </span> <script type="text/javascript">x1++; output1.textContent = x1;</script>
    O2: <span id="output2">
      </span> <script type="composite/javascript">x2++; output2.textContent = x2;</script>
    O3: <span id="output3"></span> {{Model.onC}} <script type="text/javascript"
        condition="{{Model.toggleC()}}">x3++; output3.textContent = x3;</script>
    O4: <span id="output4"></span> {{Model.onD}} <script type="composite/javascript"
        condition="{{Model.toggleD()}}">x4++; output4.textContent = x4;</script>
        
    E:<span iterate="{{list:Model.listE}}" condition="{{not Model.toggleE()}}"><span>{{list.item}}</span></span>:E

    <span condition="{{Model.toggleB()}}">A3-1 
      <span condition="{{true}}">A3-2
        <span condition="{{true}}">A3-3
          <span condition="{{true}}">A3-4
            <span condition="{{Model.toggleA()}}">A3-5
            </span>
          </span>
        </span>
      </span>
    </span>
  </body>
</html>