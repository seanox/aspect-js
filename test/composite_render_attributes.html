<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="ISO-8859-1">
    <title>Seanox aspect-js test environment</title>
    <style>
      body {
        font-family: monospace;
        white-space: pre;
      }
    </style>
    <script src="aspect-js.js"></script>
    <script type="text/javascript">
    
        Test.activate();

        Test.create({test() {
            const text = snapshots.join("\r\n\r\n");
            document.body.innerText = text;
            Assert.assertSameTo("script[type='text/test']", text);
        }});

        const snapshots = [];
        Composite.listen(Composite.EVENT_RENDER_END, () => {

            if (snapshots.length === 0) {
                document.querySelector("input[type='checkbox']").checked = false;
                document.querySelector("input[type='text']").disabled = false;
                document.querySelector("span").removeAttribute("xxx");
            }

            let snapshot = document.body.innerHTML;
            snapshot = snapshot.replace(/^\s+/mg, "");
            snapshot = snapshot.replace(/<\!--([\s\.r\n].*?)*-->/g, "");
            snapshots.push(snapshot.trim());

            if (snapshots.length < 10)
                window.setTimeout(() =>
                    Composite.render(document.body), 250);
            else Test.start();
        });
    </script>
    <script type="text/test">
      0
      false
      <input type="checkbox" checked="false">
      false
      <input type="text">
      false
      <span></span>

      1
      undefined
      <input type="checkbox">
      undefined
      <input type="text">
      undefined
      <span></span>

      2
      false
      <input type="checkbox" checked="false">
      undefined
      <input type="text">
      undefined
      <span></span>

      3
      undefined
      <input type="checkbox">
      false
      <input type="text" disabled="">
      undefined
      <span></span>

      4
      false
      <input type="checkbox" checked="false">
      undefined
      <input type="text">
      false
      <span xxx="false"></span>

      5
      undefined
      <input type="checkbox">
      undefined
      <input type="text">
      undefined
      <span></span>

      6
      false
      <input type="checkbox" checked="false">
      false
      <input type="text" disabled="">
      undefined
      <span></span>

      7
      undefined
      <input type="checkbox">
      undefined
      <input type="text">
      undefined
      <span></span>

      8
      false
      <input type="checkbox" checked="false">
      undefined
      <input type="text">
      false
      <span xxx="false"></span>

      9
      undefined
      <input type="checkbox">
      false
      <input type="text" disabled="">
      undefined
      <span></span>
    </script>
  </head>
  <body>
    <!--
      The attributes use expressions whose return value can be undefined.
      In these cases, the attribute must be temporarily removed and restored at
      the next render cycle if the return value is not undefined.
      The value false should not play a role!
    -->
    {{snapshots.length}}
    {{snapshots.length % 2 === 0 ? false : 'undefined'}}
    <input type="checkbox" checked="{{snapshots.length % 2 === 0 ? false : undefined}}"/>
    {{snapshots.length % 3 === 0 ? false : 'undefined'}}
    <input type="text" disabled="{{snapshots.length % 3 === 0 ? false : undefined}}"/>
    {{snapshots.length % 4 === 0 ? false : 'undefined'}}
    <span xxx="{{snapshots.length % 4 === 0 ? false : undefined}}"></span>
  </body>
</html>