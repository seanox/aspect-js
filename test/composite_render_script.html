<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>Seanox aspect-js test environment</title>
    <style type="text/css">
      body {
        font-family:monospace;
      }
    </style>
    <script src="aspect-js.js"></script>
    <script type="text/javascript">
    
        Test.activate();
        
        var importAv = 1;
        var importAx = 2;
        var importBv = 3;
        var importBx = 4;
        var importCv = 5;        
        var importCx = 6;
    
        Test.create({test:function() {
            var content = OutputA.textContent.replace(/\s+/g, " ").trim();
            Assert.assertEquals("A:A0", content);
        }});
        Test.create({test:function() {
            var content = OutputB.textContent.replace(/\s+/g, " ").trim();
            Assert.assertEquals("B:B4B5B6B7B8B9", content);
        }});
        Test.create({test:function() {
            var content = OutputC.textContent.replace(/\s+/g, " ").trim();
            Assert.assertEquals("C:C0C1C2", content);
        }});
        Test.create({test:function() {
            var content = OutputD.textContent.replace(/\s+/g, " ").trim();
            Assert.assertEquals("D:D0D2D4D6D8", content);
        }});
        
        Test.create({test:function() {
            Assert.assertEquals(1, importAv);
            Assert.assertEquals(2, importAx);
        }});
        Test.create({test:function() {
            Assert.assertEquals(3, importBv);
            Assert.assertEquals(4, importBx);
        }});
        Test.create({test:function() {
            Assert.assertEquals(300, importCv);
            Assert.assertEquals(15, importCx);
        }});
        Test.create({test:function() {
            var content = document.querySelector("#OutputE ~ div").innerHTML.replace(/\s+/g, " ").trim();
            Assert.assertEquals("importAv = 100; importAx++; <script type=\"text/javascript\"> importBv = 200; importBx++; <\/script> <script type=\"composite/javascript\"> importCv = 300; importCx++; <\/script>", content);
        }});       
        
        var count = 0;
        Composite.listen(Composite.EVENT_RENDER_END, function() {
            if (++count <= 9)
                Composite.render(document.body);
            else Test.start();
        }); 
    
        var ModelA = {
            isVisibleA:function() {
                return count % 2 == 0;
            },
            isVisibleB:function() {
                return count > 3;
            },
            isVisibleC:function() {
                return count < 3;
            },
            isVisibleD:function() {
                return count % 2 == 0;
            }
        };
    </script>
  </head>
  <body>
    <div id="OutputA">A:</div>
    <div>
      <script type="text/javascript" condition={{ModelA.isVisibleA()}}>
         OutputA.textContent += "A" + count;        
      </script>
    </div>
    <div id="OutputB">B:</div>
    <div>
      <script type="composite/javascript" condition={{ModelA.isVisibleB()}}>
         OutputB.textContent += "B" + count;        
      </script>
    </div>
    <div id="OutputC">C:</div>
    <div>
      <script type="composite/javascript" condition={{ModelA.isVisibleC()}}>
         OutputC.textContent += "C" + count;        
      </script>
    </div>
    <div id="OutputD">D:</div>
    <div>
      <script type="composite/javascript" condition={{ModelA.isVisibleD()}}>
         OutputD.textContent += "D" + count;        
      </script>
    </div>
    <div id="OutputE">E:</div>
    <div import="composite_render_script.import"></div>    
  </body>
</html>