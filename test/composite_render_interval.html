<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>Seanox aspect-js test environment</title>
    <style type="text/css">
      body {
        font-family:monospace;
      }
    </style>
    <script src="../sources/extension.js"></script>
    <script src="../sources/composite.js"></script>
    <script src="../sources/test.js"></script>
    <script type="text/javascript"> 
        
        var results = [];
        
        var a1 = 0;
        var b1 = 0;
        var c1 = 0;
        var a2 = 0;
        var b2 = 0;
        var c2 = 0;
        
        var aCondition = false; 
        
        var snapshots = [];
        Composite.listen(Composite.EVENT_RENDER_END, function() {
            if (typeof Test.started !== "undefined")
                return;
            Test.started = true;
            var timer = window.setInterval(function() {
                var snapshot = document.body.textContent;
                snapshot = snapshot.replace(/^\s+/mg, "");
                snapshot = snapshot.replace(/(:)\s+/g, "$1 ");
                snapshot = snapshot.replace(/\sout.*?;/g, "");
                snapshot = snapshot.replace(/\sPlease.*$/im, "");
                snapshot = snapshot.replace(/:\s+(\S+)/g, "=$1;");
                snapshots.push(snapshot);
                if (snapshots.length == 3) {
                    aCondition = true; 
                    Composite.render(document.body);                       
                }
                if (snapshots.length == 6) {
                    aCondition = false; 
                    Composite.render("#TestA");                       
                }
                if (snapshots.length == 9) {
                    aCondition = true; 
                    Composite.render(document.body);                       
                }
                if (snapshots.length < 12)
                    return;
                window.clearInterval(timer);
                Test.start();
                document.body.textContent = "Please wait, test in progress...";
            }, 1000);            
        });
            
        Test.create({test:function() {
            eval(snapshots.shift());
            Assert.assertTrue(typeof A === 'undefined');
            Assert.assertTrue(typeof B !== 'undefined');
            Assert.assertTrue(typeof C !== 'undefined');
            Assert.assertTrue(typeof S1 !== 'undefined');
            Assert.assertTrue(typeof S2 !== 'undefined');
            Assert.assertTrue(B == C && B > 1);
            Assert.assertTrue(S1 == S2 && S1 == 1);    
        }}); 
        Test.create({test:function() {
            eval(snapshots.shift());
            Assert.assertTrue(typeof A === 'undefined');
            Assert.assertTrue(B > C);
            Assert.assertTrue(S1 < S2);    
        }}); 
        Test.create({test:function() {
            eval(snapshots.shift());
            Assert.assertTrue(typeof A === 'undefined');
            Assert.assertTrue(B > C);
            Assert.assertTrue(S1 < S2);    
        }});  
        Test.create({test:function() {
            eval(snapshots.shift());
            Assert.assertTrue(typeof A !== 'undefined');
            Assert.assertTrue(A == B && B == C && A == 3);
            Assert.assertTrue(S1 == S2 && S1 == 1);              
        }});   
        Test.create({test:function() {
            eval(snapshots.shift());
            Assert.assertTrue(A > B && B > C && A == 6);
            Assert.assertTrue(S1 < S2 && S1 == 1);              
        }});   
        Test.create({test:function() {
            eval(snapshots.shift());
            Assert.assertTrue(A > B && B > C && A == 9);
            Assert.assertTrue(S1 < S2 && S1 == 2);              
        }});         
        Test.create({test:function() {
            var snapshot = snapshots.shift();
            eval(snapshot);
            Assert.assertFalse((/.*A=.*/).test(snapshot));
            Assert.assertTrue(A == 9 && B > C && B == 8);
            Assert.assertTrue(S1 < S2 && S1 == 2);              
        }});    
        Test.create({test:function() {
            var snapshot = snapshots.shift();
            eval(snapshot);
            Assert.assertFalse((/.*A=.*/).test(snapshot));
            Assert.assertTrue(A == 9 && B > C && B == 10);
            Assert.assertTrue(S1 < S2 && S1 == 2);              
        }});  
        Test.create({test:function() {
            var snapshot = snapshots.shift();
            eval(snapshot);
            Assert.assertFalse((/.*A=.*/).test(snapshot));
            Assert.assertTrue(A == 9 && B > C && B == 12);
            Assert.assertTrue(S1 < S2);              
        }}); 
        Test.create({test:function() {
            var snapshot = snapshots.shift();
            eval(snapshot);
            Assert.assertTrue((/.*A=.*/).test(snapshot));
            Assert.assertTrue(A == B && B >= C && A == 3);
            Assert.assertTrue(S1 == S2 && S1 == 1);              
        }});    
        Test.create({test:function() {
            var snapshot = snapshots.shift();
            eval(snapshot);
            Assert.assertTrue((/.*A=.*/).test(snapshot));
            Assert.assertTrue(A > B && B == C && A == 6);
            Assert.assertTrue(S1 < S2 && S1 == 1);
        }});    
        Test.create({test:function() {
            var snapshot = snapshots.shift();
            eval(snapshot);
            Assert.assertTrue((/.*A=.*/).test(snapshot));
            Assert.assertTrue(A > B && B > C && A == 9);
            Assert.assertTrue(S1 < S2 && S1 == 2);            
        }});         
    </script>
  </head>
  <body>
    {{xA:0}}
    <div id="TestA" interval="{{300 +30 +3}}" condition="{{aCondition}}">
      {{xA:parseInt(xA)+1}}
      A: {{xA}}
    </div>
    <div id="TestBC">
      {{xB:0}}
      <div id="TestB" interval="555">
        {{xB:parseInt(xB)+1}}
        B: {{xB}}
      </div>
    </div>
    <div id="TestCC">
      <div>
        <div>
          {{xC:0}}
          <div id="TestC" interval="777">
            {{xC:parseInt(xC)+1}}
            C: {{xC}}
          </div>
        </div>
      </div>
    </div>
    S1: {{s1:0}}
    <div id="outputScript1"></div>
    <script type="composite/javascript" interval="3000">
        outputScript1.textContent = ++s1;
    </script>
    S2: {{s2:0}}
    <div id="outputScript2"></div>
    <script type="composite/javascript" interval="1500">
        outputScript2.textContent = ++s2;
    </script>
    <br>
    Please wait, test in progress...
  </body>
</html>