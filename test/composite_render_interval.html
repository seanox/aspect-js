<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>Seanox aspect-js test environment</title>
    <style type="text/css">
      body {
        font-family:monospace;
      }
    </style>
    <script src="../sources/extension.js"></script>
    <script src="../sources/composite.js"></script>
    <script src="../sources/test.js"></script>
    <script src="../sources/testutils.js"></script>
    <script type="text/javascript"> 
        
        var results = new Array();
        
        var a1 = 0;
        var b1 = 0;
        var c1 = 0;
        var a2 = 0;
        var b2 = 0;
        var c2 = 0;
        
        var a1condition = false; 
        
        Composite.listen(Composite.EVENT_RENDER_END, function() {
            if (typeof(Test.started) !== "undefined")
                return;
            Test.started = true;
            
            var snapshots = new Array();
            var counter = 0;
            var timer = window.setInterval(function() {
                ++counter;
                var snapshot = document.body.textContent;
                snapshot = snapshot.replace(/^\s+/mg, "");
                snapshots.push(snapshot);
                if (counter == 3) {
                    a1condition = true; 
                    Composite.render("#TestA");                       
                }
                if (counter == 6) {
                    a1condition = false; 
                    Composite.render("#TestA");                       
                }
                if (counter < 9)
                    return;
                window.clearInterval(timer);
                Test.start();
            }, 1000);
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertTrue(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 2);
                var b1 = parseInt(match[0]);
                var c1 = parseInt(match[1]);
                Assert.assertTrue(a1 < b1 && b1 == c1);
            }}); 
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertTrue(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 2);
                var b2 = parseInt(match[0]);
                var c2 = parseInt(match[1]);
                Assert.assertTrue(a2 < b2 && b2 > c2);
                a1 = a2; b1 = b2; c1 = c2;
            }}); 
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertTrue(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 2);
                var b2 = parseInt(match[0]);
                var c2 = parseInt(match[1]);
                Assert.assertTrue(a2 < b2 && b2 > c2);
                Assert.assertTrue(a1 == a2 && b1 < b2 && c1 < c2); 
                a1 = a2; b1 = b2; c1 = c2;
            }}); 
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertFalse(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 3);
                var a2 = parseInt(match[0]);
                var b2 = parseInt(match[1]);
                var c2 = parseInt(match[2]);
                Assert.assertTrue(a2 < b2 && b2 > c2);
                Assert.assertTrue(a1 < a2 && b1 < b2 && c1 < c2); 
                a1 = a2; b1 = b2; c1 = c2;
            }}); 
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertFalse(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 3);
                var a2 = parseInt(match[0]);
                var b2 = parseInt(match[1]);
                var c2 = parseInt(match[2]);
                Assert.assertTrue(a2 < b2 && b2 > c2);
                Assert.assertTrue(a1 < a2 && b1 < b2 && c1 < c2); 
                a1 = a2; b1 = b2; c1 = c2;
            }});  
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertFalse(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 3);
                var a2 = parseInt(match[0]);
                var b2 = parseInt(match[1]);
                var c2 = parseInt(match[2]);
                Assert.assertTrue(a2 < b2 && b2 > c2);
                Assert.assertTrue(a1 < a2 && b1 < b2 && c1 < c2); 
                a1 = a2; b1 = b2; c1 = c2;
            }}); 
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertFalse(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 3);
                var a2 = parseInt(match[0]);
                var b2 = parseInt(match[1]);
                var c2 = parseInt(match[2]);
                Assert.assertTrue(a2 < b2 && b2 > c2);
                Assert.assertTrue(a1 == a2 && b1 < b2 && c1 < c2); 
                a1 = a2; b1 = b2; c1 = c2;
            }}); 
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertFalse("A", new RegExp(".*\{").test(snapshot));
                Assert.assertTrue("B", new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue("C", !!match);
                Assert.assertTrue("D", match.length == 3);
                var a2 = parseInt(match[0]);
                var b2 = parseInt(match[1]);
                var c2 = parseInt(match[2]);
                Assert.assertTrue("E", a2 < b2 && b2 > c2);
                Assert.assertTrue("F", a1 == a2 && b1 < b2 && c1 < c2); 
                a1 = a2; b1 = b2; c1 = c2;
            }}); 
            Test.create({test:function() {
                var snapshot = snapshots.shift();
                Assert.assertFalse(new RegExp(".*\{").test(snapshot));
                Assert.assertTrue(new RegExp(".*Please wait, test in progress\\.\\.\\.").test(snapshot));
                var match = snapshot.match(/^\d+/gm);
                Assert.assertTrue(!!match);
                Assert.assertTrue(match.length == 3);
                var a2 = parseInt(match[0]);
                var b2 = parseInt(match[1]);
                var c2 = parseInt(match[2]);
                Assert.assertTrue(a2 < b2 && b2 > c2);
                Assert.assertTrue(a1 == a2 && b1 < b2 && c1 < c2); 
                a1 = a2; b1 = b2; c1 = c2;
            }});
        });  
    </script>
    <script type="text/test">
    </script>
  </head>
  <body>
    {{xA:0}}
    <div id="TestA" interval="{{300 +30 +3}}" condition="{{a1condition}}">
      {{xA:parseInt(xA)+1}}
      {{xA}}
    </div>
    <div id="TestBC">
      {{xB:0}}
      <div id="TestB" interval="555">
        {{xB:parseInt(xB)+1}}
        {{xB}}
      </div>
    </div>
    <div id="TestCC">
      <div>
        <div>
          {{xC:0}}
          <div id="TestC" interval="777">
            {{xC:parseInt(xC)+1}}
            {{xC}}
          </div>
        </div>
      </div>
    </div>
    <br>
    Please wait, test in progress...
  </body>
</html>