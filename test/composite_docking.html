<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>Seanox aspect-js test environment</title>
    <style type="text/css">
      body {
        font-family:monospace;
      }
      body div {
        margin:1em;
      }
      body * {
        display:block;
      }
      *[release] {
        display:none;
      }
    </style>
    <script src="aspect-js.js"></script>
    <script type="text/javascript">
    
        Test.activate();
        
        var stack = ["Step:0"];
    
        var modelA = {
            status:true,
            dock: function() {
                stack.push("A:dock");
            },
            undock: function() {
                stack.push("A:undock");
            },
            button: {
                onClick: function() {
                    stack.push("A:onClick");
                    modelA.status = !modelA.status;
                }
            }
        };
        
        var modelB = {
            status:true,
            undock: function() {
                stack.push("B:undock");
            },
            button: {
                onClick: function() {
                    stack.push("B:onClick");
                    modelB.status = !modelB.status;
                }
            }
        }; 
        
        var modelC = {
            status:true,
            dock: function() {
                stack.push("C:dock");
            },
            button: {
                onClick: function() {
                    stack.push("C:onClick");
                    modelC.status = !modelC.status;
                }
            }
        };
        
        var modelD = {
            status:true,
            button: {
                onClick: function() {
                    stack.push("D:onClick");
                    modelD.status = !modelD.status;
                }
            }
        };
        
        var page = {
                
            //Test with the assignment via the qualifier.    
            buttonA: {
                modelA: {
                    onClick:function(event) {
                        modelA.button.onClick.call(event);
                    }
                },
                modelB: {
                    onClick:function(event) {
                        modelB.button.onClick.call(event);
                    }
                },
                modelC: {
                    onClick:function(event) {
                        modelC.button.onClick.call(event);
                    }
                },
                modelD: {
                    onClick:function(event) {
                        modelD.button.onClick.call(event);
                    }
                }
            },
            
            //Test with indirect/secondary assignment via the qualifier.
            buttonB: {
                onClick: function(event) {
                    var target = String(event.target.id.match(/[^:]+$/));
                    if (target)
                        target = Object.lookup(target + ":button:onClick");
                    if (target)
                        target.call(event);
                }
            },
            
            //Test with the assignment via the qualifier as index for an array.
            //The array is a set of anonymous object (references).
            buttonC: [
                modelA.button,
                modelB.button,
                modelC.button,
                modelD.button
            ],
            
            //Test similar to ModelA but with direct use of references.
            buttonDA: modelA.button,
            buttonDB: modelB.button,
            buttonDC: modelC.button,
            buttonDD: modelD.button,
        };

        Test.create({test:function() {
            Assert.assertSameTo("script[type='text/test-1']", stack.join("\n")); 
        }});         

        Test.create({test:function() {
            Assert.assertSameTo("script[type='text/test-2']", snapshots.join("\n")); 
        }});  
        
        var count = 0;
        var snapshots = [];
        Composite.listen(Composite.EVENT_RENDER_END, function() {
            var snapshot = document.body.textContent;
            snapshot = snapshot.replace(/Model\-/ig, "");
            snapshot = snapshot.replace(/\w+:\w+\s+\d+/ig, "");
            snapshot = snapshot.replace(/\s+/g, " ").trim(); 
            snapshots.push(":" + snapshot);
            stack.push("Step:" + (count +1));
            switch (++count) {
                case 1:
                case 2:
                case 3:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonA\\:modelA").click();
                    });
                    return;
                case 4:
                case 5:
                case 6:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonA\\:modelB").click();
                    });
                    return;
                case 7:
                case 8:
                case 9:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonA\\:modelC").click();
                    });
                    return;     
                case 10:
                case 11:
                case 12:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonA\\:modelD").click();
                    });
                    return;  
                case 13: 
                case 14: 
                case 15:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonA\\:modelX").click();
                    });
                    return; 
                    
                //----    
                case 16:
                    Composite.asynchron(() => {
                        modelA.status = true;
                        modelB.status = true;
                        modelC.status = true;
                        modelD.status = true;
                        Composite.render(document.body);
                    });
                    return;
                case 17:
                case 18:
                case 19:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonB\\:modelA").click();
                    });
                    return;
                case 20:
                case 21:
                case 22:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonB\\:modelB").click();
                    });
                    return;
                case 23:
                case 24:
                case 25:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonB\\:modelC").click();
                    });
                    return;     
                case 26:
                case 27: 
                case 28: 
                    Composite.asynchron(() => {
                        document.querySelector("#buttonB\\:modelD").click();
                    });
                    return;  
                case 29:
                case 30:
                case 31:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonB\\:modelX").click();
                    });
                    return;
                    
                //----    
                case 32:
                    Composite.asynchron(() => {
                        modelA.status = true;
                        modelB.status = true;
                        modelC.status = true;
                        modelD.status = true;
                        Composite.render(document.body);
                    });
                    return;
                    
                case 33:
                case 34:
                case 35:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonC\\:0").click();
                    });
                    return;
                case 36:
                case 37:
                case 38:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonC\\:1").click();
                    });
                    return;
                case 39:
                case 40:
                case 41:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonC\\:2").click();
                    });
                    return;     
                case 42:
                case 43: 
                case 44: 
                    Composite.asynchron(() => {
                        document.querySelector("#buttonC\\:3").click();
                    });
                    return;  
                case 45:
                case 46:
                case 47:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonC\\:4").click();
                    });
                    return;
                
                //----    
                case 48:
                    Composite.asynchron(() => {
                        modelA.status = true;
                        modelB.status = true;
                        modelC.status = true;
                        modelD.status = true;
                        Composite.render(document.body);
                    });
                    return;
                    
                case 49:
                case 50:
                case 51:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonDA").click();
                    });
                    return;
                case 52:
                case 53:
                case 54:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonDB").click();
                    });
                    return;
                case 55:
                case 56:
                case 57:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonDC").click();
                    });
                    return;     
                case 58:
                case 59: 
                case 60: 
                    Composite.asynchron(() => {
                        document.querySelector("#buttonDD").click();
                    });
                    return;  
                case 61:
                case 62:
                case 63:
                    Composite.asynchron(() => {
                        document.querySelector("#buttonDX").click();
                    });
                    return;
                case 64:
                    Test.start();
                    return;
            };
        });        
    </script>
    <script type="text/test-1">
Step:0
A:dock
C:dock
Step:1
A:onClick
Step:2
A:undock
A:onClick
A:dock
Step:3
A:onClick
Step:4
A:undock
B:onClick
Step:5
B:undock
B:onClick
Step:6
B:onClick
Step:7
B:undock
C:onClick
Step:8
C:onClick
C:dock
Step:9
C:onClick
Step:10
D:onClick
Step:11
D:onClick
Step:12
D:onClick
Step:13
Step:14
Step:15
Step:16
A:dock
C:dock
Step:17
A:onClick
Step:18
A:undock
A:onClick
A:dock
Step:19
A:onClick
Step:20
A:undock
B:onClick
Step:21
B:undock
B:onClick
Step:22
B:onClick
Step:23
B:undock
C:onClick
Step:24
C:onClick
C:dock
Step:25
C:onClick
Step:26
D:onClick
Step:27
D:onClick
Step:28
D:onClick
Step:29
Step:30
Step:31
Step:32
A:dock
C:dock
Step:33
A:onClick
Step:34
A:undock
A:onClick
A:dock
Step:35
A:onClick
Step:36
A:undock
B:onClick
Step:37
B:undock
B:onClick
Step:38
B:onClick
Step:39
B:undock
C:onClick
Step:40
C:onClick
C:dock
Step:41
C:onClick
Step:42
D:onClick
Step:43
D:onClick
Step:44
D:onClick
Step:45
Step:46
Step:47
Step:48
A:dock
C:dock
Step:49
A:onClick
Step:50
A:undock
A:onClick
A:dock
Step:51
A:onClick
Step:52
A:undock
B:onClick
Step:53
B:undock
B:onClick
Step:54
B:onClick
Step:55
B:undock
C:onClick
Step:56
C:onClick
C:dock
Step:57
C:onClick
Step:58
D:onClick
Step:59
D:onClick
Step:60
D:onClick
Step:61
Step:62
Step:63
Step:64
    </script>
    <script type="text/test-2">
:A B C D
:B C D
:A B C D
:B C D
:C D
:B C D
:C D
:D
:C D
:D
:
:D
:
:
:
:
:A B C D
:B C D
:A B C D
:B C D
:C D
:B C D
:C D
:D
:C D
:D
:
:D
:
:
:
:
:A B C D
:B C D
:A B C D
:B C D
:C D
:B C D
:C D
:D
:C D
:D
:
:D
:
:
:
:
:A B C D
:B C D
:A B C D
:B C D
:C D
:B C D
:C D
:D
:C D
:D
:
:D
:
:
:
:
    </script>
  </head>
  <body id="page" composite static>
    <button id="buttonA:modelA" events="click" render="body" release>
      Model-A:A {{modelA.status ? '1' : '0'}}</button>
    <button id="buttonB:modelA" events="click" render="body" release>
      Model-A:B {{modelA.status ? '1' : '0'}}</button>
    <button id="buttonC:0" events="click" render="body" release>
      Model-A:C {{modelA.status ? '1' : '0'}}</button>
    <button id="buttonDA" events="click" render="body" release>
      Model-A:D {{modelA.status ? '1' : '0'}}</button>
    <section id="modelA" composite static condition="{{modelA.status}}">
      Model-A
    </section>

    <button id="buttonA:modelB" events="click" render="body" release>
      Model-B:A {{modelB.status ? '1' : '0'}}</button>
    <button id="buttonB:modelB" events="click" render="body" release>
      Model-B:B {{modelB.status ? '1' : '0'}}</button>
    <button id="buttonC:1" events="click" render="body" release>
      Model-B:C {{modelB.status ? '1' : '0'}}</button>
    <button id="buttonDB" events="click" render="body" release>
      Model-B:D {{modelB.status ? '1' : '0'}}</button>
    <section id="modelB" composite static condition="{{modelB.status}}">
      Model-B
    </section>
    
    <button id="buttonA:modelC" events="click" render="body" release>
      Model-C:A {{modelC.status ? '1' : '0'}}</button>
    <button id="buttonB:modelC" events="click" render="body" release>
      Model-C:B {{modelC.status ? '1' : '0'}}</button>
    <button id="buttonC:2" events="click" render="body" release>
      Model-C:C {{modelC.status ? '1' : '0'}}</button>
    <button id="buttonDC" events="click" render="body" release>
      Model-C:D {{modelC.status ? '1' : '0'}}</button>
    <section id="modelC" composite static condition="{{modelC.status}}">
      Model-C
    </section>
    
    <button id="buttonA:modelD" events="click" render="body" release>
      Model-D:A {{modelD.status ? '1' : '0'}}</button>
    <button id="buttonB:modelD" events="click" render="body" release>
      Model-D:B {{modelD.status ? '1' : '0'}}</button>
    <button id="buttonC:3" events="click" render="body" release>
      Model-D:C {{modelD.status ? '1' : '0'}}</button>
    <button id="buttonDD" events="click" render="body" release>
      Model-D:D {{modelD.status ? '1' : '0'}}</button>
    <section id="modelD" composite static condition="{{modelD.status}}">
      Model-D
    </section>    
            
    <!-- ModelX does not exist,
         but event + render must work regardless of this fact. -->        
    <button id="buttonA:modelX" events="click" render="body" release>
      Model-X:A {{modelX.status ? '1' : '0'}}</button>
    <button id="buttonB:modelX" events="click" render="body" release>
      Model-X:B {{modelX.status ? '1' : '0'}}</button>
    <button id="buttonC:4" events="click" render="body" release>
      Model-X:C {{modelX.status ? '1' : '0'}}</button>      
    <button id="buttonDX" events="click" render="body" release>
      Model-X:D {{modelX.status ? '1' : '0'}}</button>
    <section id="modelX" composite static condition="{{modelX.status}}">
      Model-X
    </section>
  </body>
</html>